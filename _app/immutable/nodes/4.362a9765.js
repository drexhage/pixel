import{S as G,i as ee,s as Z,k as w,l as y,m as b,h as u,n as g,b as _,D as q,E as C,o as Ee,w as le,y as A,z as T,C as I,A as j,g as x,d as E,B as R,e as se,v as re,f as ie,a as U,c as X,K as ot,p as ne,L as Nn,M as Q,N as ue,F as ft,G as $t,H as ut,I as ht,q as ce,r as oe,J as be,u as ge,O as pe,P as An,Q as dt,R as Tn,T as Pe,U as jn,V as he,W as de,X as Rn}from"../chunks/index.8285138c.js";import{d as Yn,c as mt,u as Ie,e as O,S as ve,t as _e,s as we,T as fe,f as Ln,h as Un,g as me,B as ae,j as Ve,l as Ae,k as $e,m as De,n as Te,o as je,r as gt,p as pt,q as vt,v as wt,M as yt,w as Re,V as Xn,a as xt,x as Mn,y as Sn,z as Jn,A as Bn,D as qn,b as Fn,__tla as Cn}from"../chunks/VisualSwitch.58b5dcf2.js";let Et,Kn=Promise.all([(()=>{try{return Cn}catch{}})()]).then(async()=>{function bt(n){let e;return{c(){e=w("canvas"),this.h()},l(t){e=y(t,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),b(e).forEach(u),this.h()},h(){g(e,"id","canvas-overlay"),g(e,"width",n[0]),g(e,"height",n[1]),g(e,"class","svelte-qfx333")},m(t,l){_(t,e,l),n[6](e)},p(t,[l]){l&1&&g(e,"width",t[0]),l&2&&g(e,"height",t[1])},i:q,o:q,d(t){t&&u(e),n[6](null)}}}function It(n,e,t){let l,a,s;C(n,Yn,p=>t(4,l=p)),C(n,mt,p=>t(5,a=p)),C(n,Ie,p=>t(8,s=p));let{width:r}=e,{height:i}=e,c,o="#000";function f(){if(!c)return;const p=c.getContext("2d");p&&(p.clearRect(0,0,r,i),$(p),m(p))}function $(p){p.fillStyle=o,p.fillRect(0,0,r,i),p.clearRect(s.position.x,s.position.y,s.img_size.width*s.scale,s.img_size.height*s.scale)}function m(p){p.fillStyle="#FF0000",p.beginPath(),p.moveTo(s.position.x,s.position.y),p.lineTo(s.position.x+s.img_size.width*s.scale,s.position.y),p.lineTo(s.position.x+s.img_size.width*s.scale,s.position.y+s.img_size.height*s.scale),p.lineTo(s.position.x,s.position.y+s.img_size.height*s.scale),p.lineTo(s.position.x,s.position.y),p.stroke()}function h(){f()}function v(...p){setTimeout(()=>{o=getComputedStyle(document.documentElement).getPropertyValue("--color-lighter"),f()},100)}Ee(()=>{f(),v(),O.add_redraw_callback(f)});function d(p){le[p?"unshift":"push"](()=>{c=p,t(2,c)})}return n.$$set=p=>{"width"in p&&t(0,r=p.width),"height"in p&&t(1,i=p.height)},n.$$.update=()=>{n.$$.dirty&1&&r&&h(),n.$$.dirty&2&&i&&h(),n.$$.dirty&48&&v(a,l)},[r,i,c,f,l,a,d]}class _t extends G{constructor(e){super(),ee(this,e,It,bt,Z,{width:0,height:1,redraw:3})}get redraw(){return this.$$.ctx[3]}}function Dt(n){let e;return{c(){e=w("canvas"),this.h()},l(t){e=y(t,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),b(e).forEach(u),this.h()},h(){g(e,"id","canvas-alpha-pattern"),g(e,"width",n[0]),g(e,"height",n[1]),g(e,"class","svelte-qfx333")},m(t,l){_(t,e,l),n[4](e)},p(t,[l]){l&1&&g(e,"width",t[0]),l&2&&g(e,"height",t[1])},i:q,o:q,d(t){t&&u(e),n[4](null)}}}function kt(n,e,t){let{width:l}=e,{height:a}=e,s,r;function i(){r=document.createElement("canvas");let f=32;r.width=f,r.height=f;let $=r.getContext("2d");$.fillStyle="#eee",$.fillRect(0,0,f,f),$.fillStyle="#ccc",$.fillRect(0,0,f/2,f/2),$.fillRect(f/2,f/2,f/2,f/2)}function c(){if(!s)return;let f=s.getContext("2d");if(!f)return;f.beginPath();let $=f.createPattern(r,"repeat");f.fillStyle=$,f.fillRect(0,0,l,a)}Ee(()=>{i(),c()});function o(f){le[f?"unshift":"push"](()=>{s=f,t(2,s)})}return n.$$set=f=>{"width"in f&&t(0,l=f.width),"height"in f&&t(1,a=f.height)},[l,a,s,c,o]}class Ye extends G{constructor(e){super(),ee(this,e,kt,Dt,Z,{width:0,height:1,redraw:3})}get redraw(){return this.$$.ctx[3]}}function Pt(n){let e,t,l,a;return l=new ve({}),{c(){e=w("div"),t=w("div"),A(l.$$.fragment),this.h()},l(s){e=y(s,"DIV",{class:!0});var r=b(e);t=y(r,"DIV",{class:!0});var i=b(t);T(l.$$.fragment,i),i.forEach(u),r.forEach(u),this.h()},h(){g(t,"class","skeleton-image svelte-rlche6"),g(e,"class","box svelte-rlche6")},m(s,r){_(s,e,r),I(e,t),j(l,t,null),a=!0},p:q,i(s){a||(x(l.$$.fragment,s),a=!0)},o(s){E(l.$$.fragment,s),a=!1},d(s){s&&u(e),R(l)}}}class Vt extends G{constructor(e){super(),ee(this,e,null,Pt,Z,{})}}function zt(n){let e;return{c(){e=w("canvas"),this.h()},l(t){e=y(t,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),b(e).forEach(u),this.h()},h(){g(e,"id","canvas-content"),g(e,"width",n[0]),g(e,"height",n[1]),g(e,"class","svelte-qfx333")},m(t,l){_(t,e,l),n[4](e)},p(t,[l]){l&1&&g(e,"width",t[0]),l&2&&g(e,"height",t[1])},i:q,o:q,d(t){t&&u(e),n[4](null)}}}function Nt(n,e,t){let l;C(n,Ie,h=>t(8,l=h));let{width:a}=e,{height:s}=e,r,i,c,o;function f(){if(!c)return;let h;try{h=O.content_as_bytes()}catch(p){console.log(p);return}let v=new ImageData(h,l.img_size.width,l.img_size.height);o=i.getContext("2d"),o.imageSmoothingEnabled=!1,o.clearRect(0,0,i.width,i.height),o.putImageData(v,0,0),c.imageSmoothingEnabled=!1,c.clearRect(0,0,r.width,r.height);let d=l.scale;c.drawImage(i,l.position.x,l.position.y,l.img_size.width*d,l.img_size.height*d)}Ee(()=>{c=r.getContext("2d"),i=document.createElement("canvas"),f(),$(),O.add_redraw_callback(f)});function $(){l.set_canvas_size(a,s),l.center(),i&&(i.width=l.img_size.width,i.height=l.img_size.height,o=i.getContext("2d")),f()}function m(h){le[h?"unshift":"push"](()=>{r=h,t(2,r)})}return n.$$set=h=>{"width"in h&&t(0,a=h.width),"height"in h&&t(1,s=h.height)},n.$$.update=()=>{n.$$.dirty&1&&a&&$(),n.$$.dirty&2&&s&&$()},[a,s,r,f,m]}class At extends G{constructor(e){super(),ee(this,e,Nt,zt,Z,{width:0,height:1,redraw:3})}get redraw(){return this.$$.ctx[3]}}function Tt(n){let e,t;return e=new Vt({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},p:q,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function jt(n){let e,t,l,a,s,r,i,c,o,f,$={height:n[0],width:n[1]};t=new Ye({props:$}),n[14](t);let m={height:n[0],width:n[1]};a=new At({props:m}),n[15](a);let h={height:n[0],width:n[1]};return r=new _t({props:h}),n[16](r),{c(){e=w("div"),A(t.$$.fragment),l=U(),A(a.$$.fragment),s=U(),A(r.$$.fragment),this.h()},l(v){e=y(v,"DIV",{class:!0});var d=b(e);T(t.$$.fragment,d),l=X(d),T(a.$$.fragment,d),s=X(d),T(r.$$.fragment,d),d.forEach(u),this.h()},h(){g(e,"class","wrapper svelte-e86aa8"),ot(()=>n[17].call(e)),ne(e,"cursor",n[5])},m(v,d){_(v,e,d),j(t,e,null),I(e,l),j(a,e,null),I(e,s),j(r,e,null),i=Nn(e,n[17].bind(e)),c=!0,o||(f=[Q(e,"wheel",n[7]),Q(e,"mousemove",n[10]),Q(e,"pointerdown",n[8]),Q(e,"pointerup",n[9]),Q(e,"pointerleave",n[11]),Q(e,"contextmenu",Yt)],o=!0)},p(v,d){const p={};d&1&&(p.height=v[0]),d&2&&(p.width=v[1]),t.$set(p);const D={};d&1&&(D.height=v[0]),d&2&&(D.width=v[1]),a.$set(D);const Y={};d&1&&(Y.height=v[0]),d&2&&(Y.width=v[1]),r.$set(Y),d&32&&ne(e,"cursor",v[5])},i(v){c||(x(t.$$.fragment,v),x(a.$$.fragment,v),x(r.$$.fragment,v),c=!0)},o(v){E(t.$$.fragment,v),E(a.$$.fragment,v),E(r.$$.fragment,v),c=!1},d(v){v&&u(e),n[14](null),R(t),n[15](null),R(a),n[16](null),R(r),i(),o=!1,ue(f)}}}function Rt(n){let e,t,l,a;const s=[jt,Tt],r=[];function i(c,o){return c[6]?1:0}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=se()},l(c){t.l(c),l=se()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(re(),E(r[f],1,1,()=>{r[f]=null}),ie(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function Yt(n){n.preventDefault()}function Lt(n,e,t){let l,a,s;C(n,_e,P=>t(20,l=P)),C(n,Ie,P=>t(21,a=P)),C(n,we,P=>t(6,s=P));let r,i,c,o,f;async function $(){f&&f.redraw(),c.redraw(),o.redraw()}function m(P){let k=P.deltaY<0?1.05:.95,[K,V]=[P.offsetX,P.offsetY];a.zoom_at_position(K,V,k),$()}var h=(P=>(P.None="none",P.Main="main",P.Drag="drag",P))(h||{});let v="none",d,p;function D(P){if(P.button===0){let k=a.translate_position(P.offsetX,P.offsetY);t(13,v="main");let K=k[0],V=k[1];O.start(k[0],k[1]);let F=a.translate_position(d,p),W=F[0],te=F[1];O.extend(K,V,W,te)}else t(13,v="drag")}function Y(P){P.preventDefault(),t(13,v="none");let k=a.translate_position(P.offsetX,P.offsetY),K=k[0],V=k[1],F=a.translate_position(d,p),W=F[0],te=F[1];O.extend(K,V,W,te),setTimeout(()=>{O.finish(),$()},0)}function z(P){if(P.preventDefault(),v==="drag")d&&p&&a.move_relative(P.offsetX-d,P.offsetY-p);else if(v==="main"){let k=a.translate_position(P.offsetX,P.offsetY),K=a.translate_position(d,p),V=k[0],F=k[1],W=K[0],te=K[1];O.extend(V,F,W,te)}else{d=P.offsetX,p=P.offsetY;return}$(),d=P.offsetX,p=P.offsetY}function M(){v==="main"&&O.finish(),t(13,v="none")}let N;function J(P){switch(P){case"main":return l===fe.Move?"move":"default";case"drag":return"grab";default:return"default"}}function L(P){le[P?"unshift":"push"](()=>{o=P,t(3,o)})}function S(P){le[P?"unshift":"push"](()=>{f=P,t(4,f)})}function B(P){le[P?"unshift":"push"](()=>{c=P,t(2,c)})}function H(){r=this.clientHeight,i=this.clientWidth,t(0,r),t(1,i)}return n.$$.update=()=>{n.$$.dirty&8192&&t(5,N=J(v))},[r,i,c,o,f,N,s,m,D,Y,z,M,$,v,L,S,B,H]}class Ut extends G{constructor(e){super(),ee(this,e,Lt,Rt,Z,{redraw:12})}get redraw(){return this.$$.ctx[12]}}function Xt(n){let e,t;const l=n[1].default,a=ft(l,n,n[0],null);return{c(){e=w("div"),a&&a.c(),this.h()},l(s){e=y(s,"DIV",{class:!0});var r=b(e);a&&a.l(r),r.forEach(u),this.h()},h(){g(e,"class","box svelte-l7yypc")},m(s,r){_(s,e,r),a&&a.m(e,null),t=!0},p(s,[r]){a&&a.p&&(!t||r&1)&&$t(a,l,s,s[0],t?ht(l,s[0],r,null):ut(s[0]),null)},i(s){t||(x(a,s),t=!0)},o(s){E(a,s),t=!1},d(s){s&&u(e),a&&a.d(s)}}}function Mt(n,e,t){let{$$slots:l={},$$scope:a}=e;return n.$$set=s=>{"$$scope"in s&&t(0,a=s.$$scope)},[a,l]}class ye extends G{constructor(e){super(),ee(this,e,Mt,Xt,Z,{})}}function Le(n,e,t){const l=n.slice();l[4]=e[t],l[7]=t;const a=l[1].nodes[l[0].length-1-l[7]];return l[5]=a,l}function Ue(n){let e,t=n[5].id+"",l,a,s=n[5].value.data.type+"",r;return{c(){e=w("li"),l=ce(t),a=ce(", "),r=ce(s)},l(i){e=y(i,"LI",{});var c=b(e);l=oe(c,t),a=oe(c,", "),r=oe(c,s),c.forEach(u)},m(i,c){_(i,e,c),I(e,l),I(e,a),I(e,r)},p(i,c){c&3&&t!==(t=i[5].id+"")&&ge(l,t),c&3&&s!==(s=i[5].value.data.type+"")&&ge(r,s)},d(i){i&&u(e)}}}function St(n){let e,t,l,a,s={length:n[0].length},r=[];for(let i=0;i<s.length;i+=1)r[i]=Ue(Le(n,s,i));return{c(){e=w("span"),t=ce("History:"),l=U(),a=w("ul");for(let i=0;i<r.length;i+=1)r[i].c()},l(i){e=y(i,"SPAN",{});var c=b(e);t=oe(c,"History:"),c.forEach(u),l=X(i),a=y(i,"UL",{});var o=b(a);for(let f=0;f<r.length;f+=1)r[f].l(o);o.forEach(u)},m(i,c){_(i,e,c),I(e,t),_(i,l,c),_(i,a,c);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(a,null)},p(i,[c]){if(c&3){s={length:i[0].length};let o;for(o=0;o<s.length;o+=1){const f=Le(i,s,o);r[o]?r[o].p(f,c):(r[o]=Ue(f),r[o].c(),r[o].m(a,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}},i:q,o:q,d(i){i&&u(e),i&&u(l),i&&u(a),be(r,i)}}}function Jt(n,e,t){let l,a;C(n,Ln,i=>t(2,l=i)),C(n,Un,i=>t(1,a=i));function s(i){if(!a)return[];function c(o,f){return o===a.root?f.concat([o]):c(a.nodes[o].parent,f.concat([o]))}return c(i,[])}let r;return n.$$.update=()=>{n.$$.dirty&4&&t(0,r=s(l))},[r,a,l]}class Bt extends G{constructor(e){super(),ee(this,e,Jt,St,Z,{})}}function qt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-folder")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Ft(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-file")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Ct(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-image")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Kt(n){let e,t,l,a,s,r,i,c,o,f,$;return e=new ae({props:{$$slots:{default:[qt]},$$scope:{ctx:n}}}),e.$on("click",n[2]),l=new ae({props:{$$slots:{default:[Ft]},$$scope:{ctx:n}}}),l.$on("click",n[1]),c=new ae({props:{style:"pointer-events: none",$$slots:{default:[Ct]},$$scope:{ctx:n}}}),c.$on("click",ll),{c(){A(e.$$.fragment),t=U(),A(l.$$.fragment),a=U(),s=w("label"),r=w("input"),i=U(),A(c.$$.fragment),this.h()},l(m){T(e.$$.fragment,m),t=X(m),T(l.$$.fragment,m),a=X(m),s=y(m,"LABEL",{for:!0});var h=b(s);r=y(h,"INPUT",{type:!0,id:!0,style:!0,name:!0}),i=X(h),T(c.$$.fragment,h),h.forEach(u),this.h()},h(){g(r,"type","file"),g(r,"id","myfile"),ne(r,"display","none"),g(r,"name","myfile"),g(s,"for","myfile")},m(m,h){j(e,m,h),_(m,t,h),j(l,m,h),_(m,a,h),_(m,s,h),I(s,r),I(s,i),j(c,s,null),o=!0,f||($=Q(r,"change",n[4]),f=!0)},p(m,h){const v={};h&1024&&(v.$$scope={dirty:h,ctx:m}),e.$set(v);const d={};h&1024&&(d.$$scope={dirty:h,ctx:m}),l.$set(d);const p={};h&1024&&(p.$$scope={dirty:h,ctx:m}),c.$set(p)},i(m){o||(x(e.$$.fragment,m),x(l.$$.fragment,m),x(c.$$.fragment,m),o=!0)},o(m){E(e.$$.fragment,m),E(l.$$.fragment,m),E(c.$$.fragment,m),o=!1},d(m){R(e,m),m&&u(t),R(l,m),m&&u(a),m&&u(s),R(c),f=!1,$()}}}function Ht(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-arrow-up")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Qt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-arrow-down")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Wt(n){let e,t,l,a;return e=new ae({props:{disabled:n[0],$$slots:{default:[Ht]},$$scope:{ctx:n}}}),e.$on("click",n[5]),l=new ae({props:{disabled:n[0],$$slots:{default:[Qt]},$$scope:{ctx:n}}}),l.$on("click",n[6]),{c(){A(e.$$.fragment),t=U(),A(l.$$.fragment)},l(s){T(e.$$.fragment,s),t=X(s),T(l.$$.fragment,s)},m(s,r){j(e,s,r),_(s,t,r),j(l,s,r),a=!0},p(s,r){const i={};r&1&&(i.disabled=s[0]),r&1024&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const c={};r&1&&(c.disabled=s[0]),r&1024&&(c.$$scope={dirty:r,ctx:s}),l.$set(c)},i(s){a||(x(e.$$.fragment,s),x(l.$$.fragment,s),a=!0)},o(s){E(e.$$.fragment,s),E(l.$$.fragment,s),a=!1},d(s){R(e,s),s&&u(t),R(l,s)}}}function Ot(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-trash")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Zt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-random")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Gt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-copy")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function el(n){let e,t,l,a,s,r;return e=new ae({props:{disabled:n[0],$$slots:{default:[Ot]},$$scope:{ctx:n}}}),e.$on("click",n[3]),l=new ae({props:{disabled:n[0],$$slots:{default:[Zt]},$$scope:{ctx:n}}}),l.$on("click",n[7]),s=new ae({props:{disabled:n[0],$$slots:{default:[Gt]},$$scope:{ctx:n}}}),s.$on("click",n[8]),{c(){A(e.$$.fragment),t=U(),A(l.$$.fragment),a=U(),A(s.$$.fragment)},l(i){T(e.$$.fragment,i),t=X(i),T(l.$$.fragment,i),a=X(i),T(s.$$.fragment,i)},m(i,c){j(e,i,c),_(i,t,c),j(l,i,c),_(i,a,c),j(s,i,c),r=!0},p(i,c){const o={};c&1&&(o.disabled=i[0]),c&1024&&(o.$$scope={dirty:c,ctx:i}),e.$set(o);const f={};c&1&&(f.disabled=i[0]),c&1024&&(f.$$scope={dirty:c,ctx:i}),l.$set(f);const $={};c&1&&($.disabled=i[0]),c&1024&&($.$$scope={dirty:c,ctx:i}),s.$set($)},i(i){r||(x(e.$$.fragment,i),x(l.$$.fragment,i),x(s.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),E(l.$$.fragment,i),E(s.$$.fragment,i),r=!1},d(i){R(e,i),i&&u(t),R(l,i),i&&u(a),R(s,i)}}}function tl(n){let e,t,l,a,s,r,i;return t=new ye({props:{$$slots:{default:[Kt]},$$scope:{ctx:n}}}),a=new ye({props:{$$slots:{default:[Wt]},$$scope:{ctx:n}}}),r=new ye({props:{$$slots:{default:[el]},$$scope:{ctx:n}}}),{c(){e=w("div"),A(t.$$.fragment),l=U(),A(a.$$.fragment),s=U(),A(r.$$.fragment),this.h()},l(c){e=y(c,"DIV",{id:!0,class:!0});var o=b(e);T(t.$$.fragment,o),l=X(o),T(a.$$.fragment,o),s=X(o),T(r.$$.fragment,o),o.forEach(u),this.h()},h(){g(e,"id","layer-controls"),g(e,"class","svelte-s3t81j")},m(c,o){_(c,e,o),j(t,e,null),I(e,l),j(a,e,null),I(e,s),j(r,e,null),i=!0},p(c,[o]){const f={};o&1024&&(f.$$scope={dirty:o,ctx:c}),t.$set(f);const $={};o&1025&&($.$$scope={dirty:o,ctx:c}),a.$set($);const m={};o&1025&&(m.$$scope={dirty:o,ctx:c}),r.$set(m)},i(c){i||(x(t.$$.fragment,c),x(a.$$.fragment,c),x(r.$$.fragment,c),i=!0)},o(c){E(t.$$.fragment,c),E(a.$$.fragment,c),E(r.$$.fragment,c),i=!1},d(c){c&&u(e),R(t),R(a),R(r)}}}const ll=()=>{};function nl(n,e,t){let l;C(n,me,h=>t(9,l=h));function a(){if(l.length>1)return;let h=l.length===1?l[0]:0;O.perform_step({type:"layer/create/empty",move_idx:h,position:null})}function s(){if(l.length>1)return;let h=l.length===1?-l[0]:0;O.perform_step({type:"layer/create/group",move_idx:h})}function r(){O.perform_step({type:"layer/remove",ids:l}),me.set([])}function i(h){let v=h.target.files[0],d=new FileReader;d.readAsDataURL(v),d.onload=p=>{let D=p.target.result;D=D.slice(22),O.perform_step({type:"layer/create/from_data",parent:0,img:{src:"encode/png",data:D}})}}function c(){if(l.length!==1)return;let h=l[0];O.move_layer_up(h)}function o(){if(l.length!==1)return;let h=l[0];O.move_layer_down(h)}function f(){if(l.length!==1)return;let h=l[0];O.perform_step({type:"layer/merge_down",id:h})}function $(){l.length!=0&&O.perform_step({type:"layer/duplicate",id:l[0]})}let m=!0;return n.$$.update=()=>{n.$$.dirty&512&&t(0,m=l.length===0)},[m,a,s,r,i,c,o,f,$,l]}class sl extends G{constructor(e){super(),ee(this,e,nl,tl,Z,{})}}function Xe(n,e,t){const l=n.slice();return l[6]=e[t].key,l[0]=e[t].value,l[8]=t,l}function al(n){let e,t,l;return t=new ve({}),{c(){e=w("div"),A(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);T(t.$$.fragment,s),s.forEach(u),this.h()},h(){g(e,"class","box svelte-1ysb0t1")},m(a,s){_(a,e,s),j(t,e,null),l=!0},p:q,i(a){l||(x(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&u(e),R(t)}}}function rl(n){let e,t,l,a,s,r,i,c,o=n[2],f=[];for(let $=0;$<o.length;$+=1)f[$]=Me(Xe(n,o,$));return{c(){e=w("div"),t=w("select");for(let $=0;$<f.length;$+=1)f[$].c();l=U(),a=w("div"),s=w("span"),r=ce(n[1]),this.h()},l($){e=y($,"DIV",{class:!0});var m=b(e);t=y(m,"SELECT",{class:!0});var h=b(t);for(let p=0;p<f.length;p+=1)f[p].l(h);h.forEach(u),l=X(m),a=y(m,"DIV",{class:!0});var v=b(a);s=y(v,"SPAN",{});var d=b(s);r=oe(d,n[1]),d.forEach(u),v.forEach(u),m.forEach(u),this.h()},h(){g(t,"class","svelte-1ysb0t1"),n[0]===void 0&&ot(()=>n[5].call(t)),g(a,"class","title svelte-1ysb0t1"),g(e,"class","box svelte-1ysb0t1")},m($,m){_($,e,m),I(e,t);for(let h=0;h<f.length;h+=1)f[h]&&f[h].m(t,null);dt(t,n[0],!0),I(e,l),I(e,a),I(a,s),I(s,r),i||(c=[Q(t,"change",n[5]),Q(t,"change",n[4])],i=!0)},p($,m){if(m&4){o=$[2];let h;for(h=0;h<o.length;h+=1){const v=Xe($,o,h);f[h]?f[h].p(v,m):(f[h]=Me(v),f[h].c(),f[h].m(t,null))}for(;h<f.length;h+=1)f[h].d(1);f.length=o.length}m&5&&dt(t,$[0]),m&2&&ge(r,$[1])},i:q,o:q,d($){$&&u(e),be(f,$),i=!1,ue(c)}}}function Me(n){let e,t=n[0]+"",l,a;return{c(){e=w("option"),l=ce(t),this.h()},l(s){e=y(s,"OPTION",{class:!0});var r=b(e);l=oe(r,t),r.forEach(u),this.h()},h(){e.__value=a=n[0],e.value=e.__value,g(e,"class","svelte-1ysb0t1")},m(s,r){_(s,e,r),I(e,l)},p(s,r){r&4&&t!==(t=s[0]+"")&&ge(l,t),r&4&&a!==(a=s[0])&&(e.__value=a,e.value=e.__value)},d(s){s&&u(e)}}}function il(n){let e,t,l,a;const s=[rl,al],r=[];function i(c,o){return c[3]?1:0}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=se()},l(c){t.l(c),l=se()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(re(),E(r[f],1,1,()=>{r[f]=null}),ie(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function cl(n,e,t){let l;C(n,we,o=>t(3,l=o));let{value:a}=e,{title:s}=e,{options:r}=e;function i(o){pe.call(this,n,o)}function c(){a=An(this),t(0,a),t(2,r)}return n.$$set=o=>{"value"in o&&t(0,a=o.value),"title"in o&&t(1,s=o.title),"options"in o&&t(2,r=o.options)},[a,s,r,l,i,c]}class ze extends G{constructor(e){super(),ee(this,e,cl,il,Z,{value:0,title:1,options:2})}}function ol(n){let e,t,l,a,s,r,i,c,o,f=n[5](n[0])+"",$,m,h,v,d;return{c(){e=w("div"),t=w("div"),a=U(),s=w("div"),r=w("span"),i=ce(n[1]),c=U(),o=w("span"),$=ce(f),m=U(),h=w("input"),this.h()},l(p){e=y(p,"DIV",{class:!0});var D=b(e);t=y(D,"DIV",{class:!0,style:!0}),b(t).forEach(u),a=X(D),s=y(D,"DIV",{class:!0});var Y=b(s);r=y(Y,"SPAN",{});var z=b(r);i=oe(z,n[1]),z.forEach(u),c=X(Y),o=y(Y,"SPAN",{});var M=b(o);$=oe(M,f),M.forEach(u),Y.forEach(u),m=X(D),h=y(D,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0,name:!0,id:!0}),D.forEach(u),this.h()},h(){g(t,"class","selected svelte-jbas8z"),g(t,"style",l="width: "+100*n[0]/n[3]+"%"),g(s,"class","overlay svelte-jbas8z"),g(h,"type","range"),g(h,"min",n[2]),g(h,"max",n[3]),g(h,"step",n[4]),g(h,"class","slider svelte-jbas8z"),g(h,"name","slider"),g(h,"id","slider"),g(e,"class","box svelte-jbas8z")},m(p,D){_(p,e,D),I(e,t),I(e,a),I(e,s),I(s,r),I(r,i),I(s,c),I(s,o),I(o,$),I(e,m),I(e,h),Pe(h,n[0]),v||(d=[Q(h,"change",n[9]),Q(h,"input",n[9]),Q(e,"wheel",n[7])],v=!0)},p(p,D){D&9&&l!==(l="width: "+100*p[0]/p[3]+"%")&&g(t,"style",l),D&2&&ge(i,p[1]),D&33&&f!==(f=p[5](p[0])+"")&&ge($,f),D&4&&g(h,"min",p[2]),D&8&&g(h,"max",p[3]),D&16&&g(h,"step",p[4]),D&1&&Pe(h,p[0])},i:q,o:q,d(p){p&&u(e),v=!1,ue(d)}}}function fl(n){let e,t,l;return t=new ve({}),{c(){e=w("div"),A(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);T(t.$$.fragment,s),s.forEach(u),this.h()},h(){g(e,"class","box svelte-jbas8z")},m(a,s){_(a,e,s),j(t,e,null),l=!0},p:q,i(a){l||(x(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&u(e),R(t)}}}function $l(n){let e,t,l,a;const s=[fl,ol],r=[];function i(c,o){return c[6]?0:1}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=se()},l(c){t.l(c),l=se()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(re(),E(r[f],1,1,()=>{r[f]=null}),ie(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function ul(n,e,t){let l;C(n,we,h=>t(6,l=h));let{value:a}=e,{name:s}=e,{min:r}=e,{max:i}=e,{step:c=1}=e,{delta:o=.07}=e,{fmt:f=h=>h}=e;function $(h){h.deltaY>0?t(0,a=Math.max(a-i*o,r)):h.deltaY<0&&t(0,a=Math.min(a+i*o,i)),t(0,a=Math.round(1e6*a)/1e6)}function m(){a=Tn(this.value),t(0,a)}return n.$$set=h=>{"value"in h&&t(0,a=h.value),"name"in h&&t(1,s=h.name),"min"in h&&t(2,r=h.min),"max"in h&&t(3,i=h.max),"step"in h&&t(4,c=h.step),"delta"in h&&t(8,o=h.delta),"fmt"in h&&t(5,f=h.fmt)},[a,s,r,i,c,f,l,$,o,m]}class xe extends G{constructor(e){super(),ee(this,e,ul,$l,Z,{value:0,name:1,min:2,max:3,step:4,delta:8,fmt:5})}}function Se(n,e,t){const l=n.slice();return l[1]=e[t],l[3]=t,l}function Je(n){let e;return{c(){e=w("div"),this.h()},l(t){e=y(t,"DIV",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","delimiter svelte-p5s2tt")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function hl(n){let e,t={length:n[0]},l=[];for(let a=0;a<t.length;a+=1)l[a]=Je(Se(n,t,a));return{c(){e=w("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);for(let r=0;r<l.length;r+=1)l[r].l(s);s.forEach(u),this.h()},h(){g(e,"class","level svelte-p5s2tt")},m(a,s){_(a,e,s);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(a,[s]){if(s&1){t={length:a[0]};let r;for(r=0;r<t.length;r+=1){const i=Se(a,t,r);l[r]?l[r].p(i,s):(l[r]=Je(),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},i:q,o:q,d(a){a&&u(e),be(l,a)}}}function dl(n,e,t){let{level:l}=e;return n.$$set=a=>{"level"in a&&t(0,l=a.level)},[l]}class Ne extends G{constructor(e){super(),ee(this,e,dl,hl,Z,{level:0})}}function Be(n){let e,t,l,a,s,r=!n[1]&&qe();return{c(){r&&r.c(),e=U(),t=w("div"),this.h()},l(i){r&&r.l(i),e=X(i),t=y(i,"DIV",{class:!0,style:!0}),b(t).forEach(u),this.h()},h(){g(t,"class","indicator svelte-183lf69"),g(t,"style",l=`background: ${n[1]?"darkgray":"transparent"};`)},m(i,c){r&&r.m(i,c),_(i,e,c),_(i,t,c),a||(s=[Q(t,"dragover",n[3]),Q(t,"dragleave",n[4]),Q(t,"drop",n[5])],a=!0)},p(i,c){i[1]?r&&(r.d(1),r=null):r||(r=qe(),r.c(),r.m(e.parentNode,e)),c&2&&l!==(l=`background: ${i[1]?"darkgray":"transparent"};`)&&g(t,"style",l)},d(i){r&&r.d(i),i&&u(e),i&&u(t),a=!1,ue(s)}}}function qe(n){let e;return{c(){e=w("div"),this.h()},l(t){e=y(t,"DIV",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","small-indicator svelte-183lf69")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function ml(n){let e,t,l,a;t=new Ne({props:{level:n[0]}});let s=n[2]&&Be(n);return{c(){e=w("div"),A(t.$$.fragment),l=U(),s&&s.c(),this.h()},l(r){e=y(r,"DIV",{class:!0});var i=b(e);T(t.$$.fragment,i),l=X(i),s&&s.l(i),i.forEach(u),this.h()},h(){g(e,"class","box svelte-183lf69")},m(r,i){_(r,e,i),j(t,e,null),I(e,l),s&&s.m(e,null),a=!0},p(r,[i]){const c={};i&1&&(c.level=r[0]),t.$set(c),r[2]?s?s.p(r,i):(s=Be(r),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},i(r){a||(x(t.$$.fragment,r),a=!0)},o(r){E(t.$$.fragment,r),a=!1},d(r){r&&u(e),R(t),s&&s.d()}}}function gl(n,e,t){let l;C(n,Ve,f=>t(2,l=f));let{move_idx:a}=e,{level:s}=e,r=!1;function i(f){f.preventDefault(),t(1,r=!0)}function c(f){t(1,r=!1)}function o(f){let $=l;$!=null&&(O.perform_step({type:"layer/move",id:$,move_idx:a}),Ve.set(null))}return n.$$set=f=>{"move_idx"in f&&t(6,a=f.move_idx),"level"in f&&t(0,s=f.level)},n.$$.update=()=>{n.$$.dirty&6&&t(1,r=l?r:!1)},[s,r,l,i,c,o,a]}class Fe extends G{constructor(e){super(),ee(this,e,gl,ml,Z,{move_idx:6,level:0})}}function Ce(n){let e;function t(s,r){return s[3]?vl:pl}let l=t(n),a=l(n);return{c(){a.c(),e=se()},l(s){a.l(s),e=se()},m(s,r){a.m(s,r),_(s,e,r)},p(s,r){l!==(l=t(s))&&(a.d(1),a=l(s),a&&(a.c(),a.m(e.parentNode,e)))},d(s){a.d(s),s&&u(e)}}}function pl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-chevron-right")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function vl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-chevron-down")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function Ke(n){let e,t,l;function a(i,c){return i[0].value.visible?yl:wl}let s=a(n),r=s(n);return{c(){e=w("button"),r.c(),this.h()},l(i){e=y(i,"BUTTON",{class:!0});var c=b(e);r.l(c),c.forEach(u),this.h()},h(){g(e,"class","visibility svelte-ve4xfc")},m(i,c){_(i,e,c),r.m(e,null),t||(l=Q(e,"click",n[7]),t=!0)},p(i,c){s!==(s=a(i))&&(r.d(1),r=s(i),r&&(r.c(),r.m(e,null)))},d(i){i&&u(e),r.d(),t=!1,l()}}}function wl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-eye-slash")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function yl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-eye")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function He(n){let e,t;return e=new Oe({props:{children:n[0].children,level:n[1]+1,move_idx:-n[0].id}}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},p(l,a){const s={};a&1&&(s.children=l[0].children),a&2&&(s.level=l[1]+1),a&1&&(s.move_idx=-l[0].id),e.$set(s)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function xl(n){let e,t,l,a,s,r,i,c,o,f,$,m=n[0].value.name+"",h,v,d,p,D,Y,z,M,N;l=new Ne({props:{level:n[1]}});let J=n[0].value.flag.type==="Group"&&Ce(n),L=(n[2]||!n[0].value.visible)&&Ke(n),S=n[0].value.flag.type==="Group"&&n[3]&&He(n);return Y=new Fe({props:{move_idx:n[0].id,level:n[1]}}),{c(){e=w("li"),t=w("div"),A(l.$$.fragment),a=U(),s=w("div"),r=w("div"),J&&J.c(),i=U(),c=w("img"),o=U(),f=w("div"),$=w("span"),h=ce(m),v=U(),d=w("div"),L&&L.c(),p=U(),S&&S.c(),D=U(),A(Y.$$.fragment),this.h()},l(B){e=y(B,"LI",{class:!0});var H=b(e);t=y(H,"DIV",{class:!0,draggable:!0});var P=b(t);T(l.$$.fragment,P),a=X(P),s=y(P,"DIV",{class:!0});var k=b(s);r=y(k,"DIV",{class:!0});var K=b(r);J&&J.l(K),K.forEach(u),i=X(k),c=y(k,"IMG",{class:!0,alt:!0}),o=X(k),f=y(k,"DIV",{class:!0});var V=b(f);$=y(V,"SPAN",{class:!0,spellcheck:!0,contenteditable:!0});var F=b($);h=oe(F,m),F.forEach(u),v=X(V),d=y(V,"DIV",{});var W=b(d);L&&L.l(W),W.forEach(u),V.forEach(u),k.forEach(u),P.forEach(u),p=X(H),S&&S.l(H),D=X(H),T(Y.$$.fragment,H),H.forEach(u),this.h()},h(){g(r,"class","left-of-preview svelte-ve4xfc"),g(c,"class","preview svelte-ve4xfc"),g(c,"alt","preview of layer"),g($,"class","layer-name"),g($,"spellcheck","false"),g($,"contenteditable",n[5]),g(f,"class","right-of-preview svelte-ve4xfc"),g(s,"class","layer-info svelte-ve4xfc"),g(t,"class","layer-box svelte-ve4xfc"),g(t,"draggable","true"),g(e,"class","layers svelte-ve4xfc"),ne(e,"background",n[5]?"var(--color-lighter)":"var(--color-lightest)")},m(B,H){_(B,e,H),I(e,t),j(l,t,null),I(t,a),I(t,s),I(s,r),J&&J.m(r,null),I(s,i),I(s,c),n[15](c),I(s,o),I(s,f),I(f,$),I($,h),I(f,v),I(f,d),L&&L.m(d,null),I(e,p),S&&S.m(e,null),I(e,D),j(Y,e,null),z=!0,M||(N=[Q(r,"click",n[8]),Q(r,"keydown",n[14]),Q($,"input",n[10]),Q(t,"click",n[6]),Q(t,"keydown",n[13]),Q(t,"mouseenter",n[9](!0)),Q(t,"mouseleave",n[9](!1)),Q(t,"dragstart",n[11](!0)),Q(t,"dragend",n[11](!1))],M=!0)},p(B,[H]){const P={};H&2&&(P.level=B[1]),l.$set(P),B[0].value.flag.type==="Group"?J?J.p(B,H):(J=Ce(B),J.c(),J.m(r,null)):J&&(J.d(1),J=null),(!z||H&1)&&m!==(m=B[0].value.name+"")&&jn(h,m,B[5]),(!z||H&32)&&g($,"contenteditable",B[5]),B[2]||!B[0].value.visible?L?L.p(B,H):(L=Ke(B),L.c(),L.m(d,null)):L&&(L.d(1),L=null),B[0].value.flag.type==="Group"&&B[3]?S?(S.p(B,H),H&9&&x(S,1)):(S=He(B),S.c(),x(S,1),S.m(e,D)):S&&(re(),E(S,1,1,()=>{S=null}),ie());const k={};H&1&&(k.move_idx=B[0].id),H&2&&(k.level=B[1]),Y.$set(k),H&32&&ne(e,"background",B[5]?"var(--color-lighter)":"var(--color-lightest)")},i(B){z||(x(l.$$.fragment,B),x(S),x(Y.$$.fragment,B),z=!0)},o(B){E(l.$$.fragment,B),E(S),E(Y.$$.fragment,B),z=!1},d(B){B&&u(e),R(l),J&&J.d(),n[15](null),L&&L.d(),S&&S.d(),R(Y),M=!1,ue(N)}}}function El(n,e,t){let l;C(n,me,L=>t(12,l=L));let{node:a}=e,{level:s}=e,r=!1,i=!0,c,[o,f]=a.value.size,$=O.get_content_of(a.value.pointer,o,f),m=new ImageData($,o,f);Ee(async()=>{if(!c||!m)return;let L=document.createElement("canvas");L.width=o,L.height=f,L.getContext("2d").putImageData(m,0,0),t(4,c.src=L.toDataURL("image/png"),c)});function h(L){let S=L.shiftKey,B=l.includes(a.id);S?B?me.update(H=>H.filter(P=>P!==a.id)):me.update(H=>H.concat([a.id])):me.set([a.id])}function v(){O.perform_step({type:"layer/attr",id:a.id,visible:!a.value.visible})}function d(){t(3,i=!i)}function p(L){return()=>{t(2,r=L)}}function D(L){if(L.inputType==="insertParagraph"||L.inputType==="insertText"&&!L.data){L.stopPropagation();let S=L.target.innerText;S=S.replace(`
`,""),S=S.replace("\r",""),L.target.innerText=S,S!=a.value.name&&O.perform_step({type:"layer/attr",id:a.id,name:S});return}}function Y(L){return()=>{L?Ve.set(a.id):Ve.set(null)}}let z=!1;function M(L){pe.call(this,n,L)}function N(L){pe.call(this,n,L)}function J(L){le[L?"unshift":"push"](()=>{c=L,t(4,c)})}return n.$$set=L=>{"node"in L&&t(0,a=L.node),"level"in L&&t(1,s=L.level)},n.$$.update=()=>{n.$$.dirty&4097&&t(5,z=l.includes(a.id))},[a,s,r,i,c,z,h,v,d,p,D,Y,l,M,N,J]}class bl extends G{constructor(e){super(),ee(this,e,El,xl,Z,{node:0,level:1})}}function Qe(n,e,t){const l=n.slice();l[4]=e[t],l[8]=t;const a=l[0][l[0].length-1-l[8]];l[5]=a;const s=l[3].nodes[l[5]];return l[6]=s,l}function We(n){let e,t;return e=new bl({props:{node:n[6],level:n[2]}}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},p(l,a){const s={};a&9&&(s.node=l[6]),a&4&&(s.level=l[2]),e.$set(s)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function Il(n){let e,t,l,a,s,r,i;t=new Ne({props:{level:n[2]}}),a=new Fe({props:{move_idx:n[1],level:n[2]}});let c={length:n[0].length},o=[];for(let $=0;$<c.length;$+=1)o[$]=We(Qe(n,c,$));const f=$=>E(o[$],1,1,()=>{o[$]=null});return{c(){e=w("div"),A(t.$$.fragment),l=U(),A(a.$$.fragment),s=U(),r=w("ul");for(let $=0;$<o.length;$+=1)o[$].c();this.h()},l($){e=y($,"DIV",{});var m=b(e);T(t.$$.fragment,m),l=X(m),T(a.$$.fragment,m),s=X(m),r=y(m,"UL",{class:!0});var h=b(r);for(let v=0;v<o.length;v+=1)o[v].l(h);h.forEach(u),m.forEach(u),this.h()},h(){g(r,"class","layers svelte-m4bv1g")},m($,m){_($,e,m),j(t,e,null),I(e,l),j(a,e,null),I(e,s),I(e,r);for(let h=0;h<o.length;h+=1)o[h]&&o[h].m(r,null);i=!0},p($,[m]){const h={};m&4&&(h.level=$[2]),t.$set(h);const v={};if(m&2&&(v.move_idx=$[1]),m&4&&(v.level=$[2]),a.$set(v),m&13){c={length:$[0].length};let d;for(d=0;d<c.length;d+=1){const p=Qe($,c,d);o[d]?(o[d].p(p,m),x(o[d],1)):(o[d]=We(p),o[d].c(),x(o[d],1),o[d].m(r,null))}for(re(),d=c.length;d<o.length;d+=1)f(d);ie()}},i($){if(!i){x(t.$$.fragment,$),x(a.$$.fragment,$);for(let m=0;m<c.length;m+=1)x(o[m]);i=!0}},o($){E(t.$$.fragment,$),E(a.$$.fragment,$),o=o.filter(Boolean);for(let m=0;m<o.length;m+=1)E(o[m]);i=!1},d($){$&&u(e),R(t),R(a),be(o,$)}}}function _l(n,e,t){let l;C(n,Ae,i=>t(3,l=i));let{children:a}=e,{move_idx:s=0}=e,{level:r=0}=e;return n.$$set=i=>{"children"in i&&t(0,a=i.children),"move_idx"in i&&t(1,s=i.move_idx),"level"in i&&t(2,r=i.level)},[a,s,r,l]}class Oe extends G{constructor(e){super(),ee(this,e,_l,Il,Z,{children:0,move_idx:1,level:2})}}function Dl(n){let e;return{c(){e=w("hr"),this.h()},l(t){e=y(t,"HR",{class:!0}),this.h()},h(){g(e,"class","svelte-1ahopmk")},m(t,l){_(t,e,l)},p:q,i:q,o:q,d(t){t&&u(e)}}}class ke extends G{constructor(e){super(),ee(this,e,null,Dl,Z,{})}}function kl(n){let e;return{c(){e=w("div")},l(t){e=y(t,"DIV",{}),b(e).forEach(u)},m(t,l){_(t,e,l)},p:q,i:q,o:q,d(t){t&&u(e)}}}function Pl(n){let e,t,l,a,s,r,i,c,o,f;function $(d){n[6](d)}let m={min:0,max:1,step:.01,name:"alpha",fmt:Al};n[1]!==void 0&&(m.value=n[1]),l=new xe({props:m}),le.push(()=>he(l,"value",$));function h(d){n[7](d)}let v={title:"mode",options:[{key:null,value:$e.Alpha},{key:null,value:$e.Remove},{key:null,value:$e.Lighten},{key:null,value:$e.Darken},{key:null,value:$e.Screen}]};return n[2]!==void 0&&(v.value=n[2]),r=new ze({props:v}),le.push(()=>he(r,"value",h)),o=new ke({}),{c(){e=w("div"),t=w("div"),A(l.$$.fragment),s=U(),A(r.$$.fragment),c=U(),A(o.$$.fragment),this.h()},l(d){e=y(d,"DIV",{});var p=b(e);t=y(p,"DIV",{id:!0,class:!0});var D=b(t);T(l.$$.fragment,D),s=X(D),T(r.$$.fragment,D),D.forEach(u),c=X(p),T(o.$$.fragment,p),p.forEach(u),this.h()},h(){g(t,"id","layers-attributes"),g(t,"class","svelte-4zwbd8")},m(d,p){_(d,e,p),I(e,t),j(l,t,null),I(t,s),j(r,t,null),I(e,c),j(o,e,null),f=!0},p(d,p){const D={};!a&&p&2&&(a=!0,D.value=d[1],de(()=>a=!1)),l.$set(D);const Y={};!i&&p&4&&(i=!0,Y.value=d[2],de(()=>i=!1)),r.$set(Y)},i(d){f||(x(l.$$.fragment,d),x(r.$$.fragment,d),x(o.$$.fragment,d),f=!0)},o(d){E(l.$$.fragment,d),E(r.$$.fragment,d),E(o.$$.fragment,d),f=!1},d(d){d&&u(e),R(l),R(r),R(o)}}}function Vl(n){let e,t,l,a;return l=new Oe({props:{children:n[3].nodes[n[3].root].children}}),{c(){e=w("div"),t=w("div"),A(l.$$.fragment),this.h()},l(s){e=y(s,"DIV",{id:!0,class:!0});var r=b(e);t=y(r,"DIV",{id:!0,class:!0});var i=b(t);T(l.$$.fragment,i),i.forEach(u),r.forEach(u),this.h()},h(){g(t,"id","layers-list"),g(t,"class","svelte-4zwbd8"),g(e,"id","layer-list-box"),g(e,"class","svelte-4zwbd8")},m(s,r){_(s,e,r),I(e,t),j(l,t,null),a=!0},p(s,r){const i={};r&8&&(i.children=s[3].nodes[s[3].root].children),l.$set(i)},i(s){a||(x(l.$$.fragment,s),a=!0)},o(s){E(l.$$.fragment,s),a=!1},d(s){s&&u(e),R(l)}}}function zl(n){let e,t;return e=new ve({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},p:q,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function Ze(n){let e,t,l,a,s,r,i,c,o,f,$,m;const h=[Pl,kl],v=[];function d(z,M){return z[0]||z[4]?0:1}t=d(n),l=v[t]=h[t](n);const p=[zl,Vl],D=[];function Y(z,M){return z[4]?0:1}return s=Y(n),r=D[s]=p[s](n),c=new ke({}),$=new sl({}),{c(){e=w("div"),l.c(),a=U(),r.c(),i=U(),A(c.$$.fragment),o=U(),f=w("div"),A($.$$.fragment),this.h()},l(z){e=y(z,"DIV",{id:!0,class:!0});var M=b(e);l.l(M),a=X(M),r.l(M),i=X(M),T(c.$$.fragment,M),o=X(M),f=y(M,"DIV",{});var N=b(f);T($.$$.fragment,N),N.forEach(u),M.forEach(u),this.h()},h(){g(e,"id","layers-box"),g(e,"class","svelte-4zwbd8")},m(z,M){_(z,e,M),v[t].m(e,null),I(e,a),D[s].m(e,null),I(e,i),j(c,e,null),I(e,o),I(e,f),j($,f,null),m=!0},p(z,M){let N=t;t=d(z),t===N?v[t].p(z,M):(re(),E(v[N],1,1,()=>{v[N]=null}),ie(),l=v[t],l?l.p(z,M):(l=v[t]=h[t](z),l.c()),x(l,1),l.m(e,a));let J=s;s=Y(z),s===J?D[s].p(z,M):(re(),E(D[J],1,1,()=>{D[J]=null}),ie(),r=D[s],r?r.p(z,M):(r=D[s]=p[s](z),r.c()),x(r,1),r.m(e,i))},i(z){m||(x(l),x(r),x(c.$$.fragment,z),x($.$$.fragment,z),m=!0)},o(z){E(l),E(r),E(c.$$.fragment,z),E($.$$.fragment,z),m=!1},d(z){z&&u(e),v[t].d(),D[s].d(),R(c),R($)}}}function Nl(n){let e=n[3],t,l,a=Ze(n);return{c(){a.c(),t=se()},l(s){a.l(s),t=se()},m(s,r){a.m(s,r),_(s,t,r),l=!0},p(s,[r]){r&8&&Z(e,e=s[3])?(re(),E(a,1,1,q),ie(),a=Ze(s),a.c(),x(a,1),a.m(t.parentNode,t)):a.p(s,r)},i(s){l||(x(a),l=!0)},o(s){E(a),l=!1},d(s){s&&u(t),a.d(s)}}}const Al=n=>`${~~(n*100)}%`;function Tl(n,e,t){let l,a,s;C(n,Ae,d=>t(3,l=d)),C(n,me,d=>t(5,a=d)),C(n,we,d=>t(4,s=d));let r=null,i=null,c=0,o=$e.Alpha;function f(d){i=d?l.nodes[d]:null,t(1,c=i&&i.value.attr.alpha),t(2,o=i&&i.value.attr.mode)}function $(d){i&&c!=i.value.attr.alpha&&O.perform_step({type:"layer/attr",id:i.id,alpha:d})}function m(d){i&&d!=i.value.attr.mode&&O.perform_step({type:"layer/attr",id:i.id,mode:d})}function h(d){c=d,t(1,c)}function v(d){o=d,t(2,o)}return n.$$.update=()=>{n.$$.dirty&32&&t(0,r=a.length===1?a[0]:null),n.$$.dirty&1&&r&&f(r),n.$$.dirty&2&&$(c),n.$$.dirty&4&&m(o)},[r,c,o,l,s,a,h,v]}class jl extends G{constructor(e){super(),ee(this,e,Tl,Nl,Z,{})}}function Rl(n){let e,t,l;return t=new ve({}),{c(){e=w("div"),A(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);T(t.$$.fragment,s),s.forEach(u),this.h()},h(){g(e,"class","box svelte-1xn751k"),ne(e,"width",`${n[0]}px`),ne(e,"height",`${n[1]}px`)},m(a,s){_(a,e,s),j(t,e,null),l=!0},p(a,s){s&1&&ne(e,"width",`${a[0]}px`),s&2&&ne(e,"height",`${a[1]}px`)},i(a){l||(x(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&u(e),R(t)}}}function Yl(n){let e,t,l,a,s,r={height:n[1],width:n[0]};return t=new Ye({props:r}),n[9](t),{c(){e=w("div"),A(t.$$.fragment),l=U(),a=w("canvas"),this.h()},l(i){e=y(i,"DIV",{class:!0});var c=b(e);T(t.$$.fragment,c),l=X(c),a=y(c,"CANVAS",{id:!0,height:!0,width:!0,class:!0}),b(a).forEach(u),c.forEach(u),this.h()},h(){g(a,"id","brush-preview"),g(a,"height",n[1]),g(a,"width",n[0]),g(a,"class","svelte-1xn751k"),g(e,"class","box svelte-1xn751k"),ne(e,"width",`${n[0]}px`),ne(e,"height",`${n[1]}px`)},m(i,c){_(i,e,c),j(t,e,null),I(e,l),I(e,a),n[10](a),s=!0},p(i,c){const o={};c&2&&(o.height=i[1]),c&1&&(o.width=i[0]),t.$set(o),(!s||c&2)&&g(a,"height",i[1]),(!s||c&1)&&g(a,"width",i[0]),c&1&&ne(e,"width",`${i[0]}px`),c&2&&ne(e,"height",`${i[1]}px`)},i(i){s||(x(t.$$.fragment,i),s=!0)},o(i){E(t.$$.fragment,i),s=!1},d(i){i&&u(e),n[9](null),R(t),n[10](null)}}}function Ll(n){let e,t,l,a;const s=[Yl,Rl],r=[];function i(c,o){return c[4]?1:0}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=se()},l(c){t.l(c),l=se()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(re(),E(r[f],1,1,()=>{r[f]=null}),ie(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function Ul(n){let e=parseInt(n.substring(1),16),t=e>>16&255,l=e>>8&255,a=e&255;return[t,l,a]}function Xl(n,e,t){let l,a,s,r,i;C(n,_e,d=>t(5,l=d)),C(n,De,d=>t(6,a=d)),C(n,Te,d=>t(7,s=d)),C(n,je,d=>t(8,r=d)),C(n,we,d=>t(4,i=d));let{width:c}=e,{height:o}=e,f,$;function m(d,p,D,Y,z){if(!d)return;let M=d.getContext("2d"),N=Math.min(o,c)/2,J=N*D;const L=M.createImageData(c,o);let S=L.data,[B,H,P]=Ul(Y);for(let k=0;k<o;k++)for(let K=0;K<c;K++){let V=4*(k*c+K);S[V]=B,S[V+1]=H,S[V+2]=P,S[V+3]=0;let F=Math.sqrt((K-c/2)**2+(k-o/2)**2);if(z)if(S[V+3]=255-p,F<=N&&F>J){let W=(F-J)/(N-J);S[V+3]=Math.min(~~(255*W)+S[V+3],255)}else F>N&&(S[V+3]=255);else if(F<=J)S[V+3]=p;else if(F<=N){let W=1-(F-J)/(N-J);S[V+3]=~~(p*W)}}M.putImageData(L,0,0)}function h(d){le[d?"unshift":"push"](()=>{$=d,t(3,$)})}function v(d){le[d?"unshift":"push"](()=>{f=d,t(2,f)})}return n.$$set=d=>{"width"in d&&t(0,c=d.width),"height"in d&&t(1,o=d.height)},n.$$.update=()=>{n.$$.dirty&484&&m(f,r,s,a,l===fe.Eraser)},[c,o,f,$,i,l,a,s,r,h,v]}class Ml extends G{constructor(e){super(),ee(this,e,Xl,Ll,Z,{width:0,height:1})}}function Ge(n,e,t){const l=n.slice();return l[18]=e[t].value,l[19]=e[t].label,l}function Sl(n){let e,t,l,a;e=new ye({props:{$$slots:{default:[Fl]},$$scope:{ctx:n}}});let s=n[8],r=[];for(let i=0;i<s.length;i+=1)r[i]=et(Ge(n,s,i));return{c(){A(e.$$.fragment),t=U(),l=w("ul");for(let i=0;i<r.length;i+=1)r[i].c()},l(i){T(e.$$.fragment,i),t=X(i),l=y(i,"UL",{});var c=b(l);for(let o=0;o<r.length;o+=1)r[o].l(c);c.forEach(u)},m(i,c){j(e,i,c),_(i,t,c),_(i,l,c);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(l,null);a=!0},p(i,c){const o={};if(c&4194305&&(o.$$scope={dirty:c,ctx:i}),e.$set(o),c&384){s=i[8];let f;for(f=0;f<s.length;f+=1){const $=Ge(i,s,f);r[f]?r[f].p($,c):(r[f]=et($),r[f].c(),r[f].m(l,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}},i(i){a||(x(e.$$.fragment,i),a=!0)},o(i){E(e.$$.fragment,i),a=!1},d(i){R(e,i),i&&u(t),i&&u(l),be(r,i)}}}function Jl(n){let e,t,l,a,s,r,i,c,o,f,$,m,h,v,d,p,D,Y;t=new Ml({props:{width:60,height:60}});function z(k){n[11](k)}let M={min:0,max:255,name:"alpha",fmt:Kl};n[2]!==void 0&&(M.value=n[2]),s=new xe({props:M}),le.push(()=>he(s,"value",z));function N(k){n[12](k)}let J={min:0,max:1,step:.01,name:"hardness",fmt:Hl};n[3]!==void 0&&(J.value=n[3]),c=new xe({props:J}),le.push(()=>he(c,"value",N));function L(k){n[13](k)}let S={min:0,max:100,name:"radius",fmt:Ql};n[4]!==void 0&&(S.value=n[4]),$=new xe({props:S}),le.push(()=>he($,"value",L));function B(k){n[14](k)}let H={min:1,max:100,step:1,name:"distance",fmt:Wl};n[5]!==void 0&&(H.value=n[5]),v=new xe({props:H}),le.push(()=>he(v,"value",B));let P=n[1]===fe.Brush&&tt(n);return{c(){e=w("div"),A(t.$$.fragment),l=U(),a=w("div"),A(s.$$.fragment),i=U(),A(c.$$.fragment),f=U(),A($.$$.fragment),h=U(),A(v.$$.fragment),p=U(),P&&P.c(),D=se(),this.h()},l(k){e=y(k,"DIV",{class:!0});var K=b(e);T(t.$$.fragment,K),l=X(K),a=y(K,"DIV",{class:!0});var V=b(a);T(s.$$.fragment,V),i=X(V),T(c.$$.fragment,V),V.forEach(u),K.forEach(u),f=X(k),T($.$$.fragment,k),h=X(k),T(v.$$.fragment,k),p=X(k),P&&P.l(k),D=se(),this.h()},h(){g(a,"class","whatever svelte-m5l18c"),g(e,"class","compact svelte-m5l18c")},m(k,K){_(k,e,K),j(t,e,null),I(e,l),I(e,a),j(s,a,null),I(a,i),j(c,a,null),_(k,f,K),j($,k,K),_(k,h,K),j(v,k,K),_(k,p,K),P&&P.m(k,K),_(k,D,K),Y=!0},p(k,K){const V={};!r&&K&4&&(r=!0,V.value=k[2],de(()=>r=!1)),s.$set(V);const F={};!o&&K&8&&(o=!0,F.value=k[3],de(()=>o=!1)),c.$set(F);const W={};!m&&K&16&&(m=!0,W.value=k[4],de(()=>m=!1)),$.$set(W);const te={};!d&&K&32&&(d=!0,te.value=k[5],de(()=>d=!1)),v.$set(te),k[1]===fe.Brush?P?(P.p(k,K),K&2&&x(P,1)):(P=tt(k),P.c(),x(P,1),P.m(D.parentNode,D)):P&&(re(),E(P,1,1,()=>{P=null}),ie())},i(k){Y||(x(t.$$.fragment,k),x(s.$$.fragment,k),x(c.$$.fragment,k),x($.$$.fragment,k),x(v.$$.fragment,k),x(P),Y=!0)},o(k){E(t.$$.fragment,k),E(s.$$.fragment,k),E(c.$$.fragment,k),E($.$$.fragment,k),E(v.$$.fragment,k),E(P),Y=!1},d(k){k&&u(e),R(t),R(s),R(c),k&&u(f),R($,k),k&&u(h),R(v,k),k&&u(p),P&&P.d(k),k&&u(D)}}}function Bl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa-solid fa-up-down")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function ql(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa-solid fa-left-right")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function Fl(n){let e,t,l,a;return e=new ae({props:{disabled:!n[0],title:"flip vertically",$$slots:{default:[Bl]},$$scope:{ctx:n}}}),e.$on("click",n[9]("vertically")),l=new ae({props:{disabled:!n[0],title:"flip horizontally",$$slots:{default:[ql]},$$scope:{ctx:n}}}),l.$on("click",n[9]("horizontally")),{c(){A(e.$$.fragment),t=U(),A(l.$$.fragment)},l(s){T(e.$$.fragment,s),t=X(s),T(l.$$.fragment,s)},m(s,r){j(e,s,r),_(s,t,r),j(l,s,r),a=!0},p(s,r){const i={};r&1&&(i.disabled=!s[0]),r&4194304&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const c={};r&1&&(c.disabled=!s[0]),r&4194304&&(c.$$scope={dirty:r,ctx:s}),l.$set(c)},i(s){a||(x(e.$$.fragment,s),x(l.$$.fragment,s),a=!0)},o(s){E(e.$$.fragment,s),E(l.$$.fragment,s),a=!1},d(s){R(e,s),s&&u(t),R(l,s)}}}function et(n){let e,t,l=n[19]+"",a,s,r,i,c;return r=Rn(n[17][0]),{c(){e=w("li"),t=w("input"),a=ce(l),s=U(),this.h()},l(o){e=y(o,"LI",{});var f=b(e);t=y(f,"INPUT",{type:!0}),a=oe(f,l),s=X(f),f.forEach(u),this.h()},h(){g(t,"type","radio"),t.__value=n[18],t.value=t.__value,r.p(t)},m(o,f){_(o,e,f),I(e,t),t.checked=t.__value===n[7],I(e,a),I(e,s),i||(c=Q(t,"change",n[16]),i=!0)},p(o,f){f&128&&(t.checked=t.__value===o[7])},d(o){o&&u(e),r.r(),i=!1,c()}}}function tt(n){let e,t,l;function a(r){n[15](r)}let s={title:"mode",options:[{key:null,value:$e.Alpha},{key:null,value:$e.Darken},{key:null,value:$e.Lighten},{key:null,value:$e.Screen}]};return n[6]!==void 0&&(s.value=n[6]),e=new ze({props:s}),le.push(()=>he(e,"value",a)),{c(){A(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,i){j(e,r,i),l=!0},p(r,i){const c={};!t&&i&64&&(t=!0,c.value=r[6],de(()=>t=!1)),e.$set(c)},i(r){l||(x(e.$$.fragment,r),l=!0)},o(r){E(e.$$.fragment,r),l=!1},d(r){R(e,r)}}}function Cl(n){let e,t,l,a;const s=[Jl,Sl],r=[];function i(c,o){return c[1]===fe.Brush||c[1]===fe.Eraser?0:c[1]===fe.Move?1:-1}return~(t=i(n))&&(l=r[t]=s[t](n)),{c(){e=w("div"),l&&l.c(),this.h()},l(c){e=y(c,"DIV",{class:!0});var o=b(e);l&&l.l(o),o.forEach(u),this.h()},h(){g(e,"class","box svelte-m5l18c")},m(c,o){_(c,e,o),~t&&r[t].m(e,null),a=!0},p(c,[o]){let f=t;t=i(c),t===f?~t&&r[t].p(c,o):(l&&(re(),E(r[f],1,1,()=>{r[f]=null}),ie()),~t?(l=r[t],l?l.p(c,o):(l=r[t]=s[t](c),l.c()),x(l,1),l.m(e,null)):l=null)},i(c){a||(x(l),a=!0)},o(c){E(l),a=!1},d(c){c&&u(e),~t&&r[t].d()}}}const Kl=n=>`${~~(n/255*100)}%`,Hl=n=>`${~~(n*100)}%`,Ql=n=>`${n}px`,Wl=n=>`${n}`;function Ol(n,e,t){let l,a,s,r,i,c,o,f;C(n,me,N=>t(10,l=N)),C(n,_e,N=>t(1,a=N)),C(n,je,N=>t(2,s=N)),C(n,Te,N=>t(3,r=N)),C(n,gt,N=>t(4,i=N)),C(n,pt,N=>t(5,c=N)),C(n,vt,N=>t(6,o=N)),C(n,wt,N=>t(7,f=N));const $=[{value:yt.Selected,label:"Move selected layer"},{value:yt.Clicked,label:"Move layer that is clicked"}];function m(N){return()=>{l.length!=0&&O.perform_step({type:"layer/flip",id:l[0],direction:N})}}let h=l.length==1;const v=[[]];function d(N){s=N,je.set(s)}function p(N){r=N,Te.set(r)}function D(N){i=N,gt.set(i)}function Y(N){c=N,pt.set(c)}function z(N){o=N,vt.set(o)}function M(){f=this.__value,wt.set(f)}return n.$$.update=()=>{n.$$.dirty&1024&&t(0,h=l.length==1)},[h,a,s,r,i,c,o,f,$,m,l,d,p,D,Y,z,M,v]}class Zl extends G{constructor(e){super(),ee(this,e,Ol,Cl,Z,{})}}function Gl(n){let e,t,l,a,s,r;return t=new ve({}),s=new ve({}),{c(){e=w("div"),A(t.$$.fragment),l=U(),a=w("div"),A(s.$$.fragment),this.h()},l(i){e=y(i,"DIV",{class:!0});var c=b(e);T(t.$$.fragment,c),c.forEach(u),l=X(i),a=y(i,"DIV",{class:!0});var o=b(a);T(s.$$.fragment,o),o.forEach(u),this.h()},h(){g(e,"class","color-box color2 svelte-i90gv5"),g(a,"class","color-box color1 svelte-i90gv5")},m(i,c){_(i,e,c),j(t,e,null),_(i,l,c),_(i,a,c),j(s,a,null),r=!0},p:q,i(i){r||(x(t.$$.fragment,i),x(s.$$.fragment,i),r=!0)},o(i){E(t.$$.fragment,i),E(s.$$.fragment,i),r=!1},d(i){i&&u(e),R(t),i&&u(l),i&&u(a),R(s)}}}function en(n){let e,t,l,a,s,r,i,c;return{c(){e=w("div"),t=U(),l=w("label"),a=w("div"),s=U(),r=w("input"),this.h()},l(o){e=y(o,"DIV",{class:!0,style:!0}),b(e).forEach(u),t=X(o),l=y(o,"LABEL",{});var f=b(l);a=y(f,"DIV",{class:!0,style:!0}),b(a).forEach(u),s=X(f),r=y(f,"INPUT",{type:!0}),f.forEach(u),this.h()},h(){g(e,"class","color-box color2 svelte-i90gv5"),ne(e,"background-color",n[0]),g(a,"class","color-box color1 svelte-i90gv5"),ne(a,"background-color",n[1]),g(r,"type","color"),r.hidden=!0},m(o,f){_(o,e,f),_(o,t,f),_(o,l,f),I(l,a),I(l,s),I(l,r),Pe(r,n[1]),i||(c=[Q(e,"click",n[3]),Q(e,"keydown",n[6]),Q(r,"input",n[7])],i=!0)},p(o,f){f&1&&ne(e,"background-color",o[0]),f&2&&ne(a,"background-color",o[1]),f&2&&Pe(r,o[1])},i:q,o:q,d(o){o&&u(e),o&&u(t),o&&u(l),i=!1,ue(c)}}}function lt(n){let e,t,l,a,s,r;return{c(){e=w("div"),t=w("div"),l=U(),a=w("div"),this.h()},l(i){e=y(i,"DIV",{});var c=b(e);t=y(c,"DIV",{class:!0}),b(t).forEach(u),l=X(c),a=y(c,"DIV",{class:!0}),b(a).forEach(u),c.forEach(u),this.h()},h(){g(t,"class","default-box default-black svelte-i90gv5"),g(a,"class","default-box default-white svelte-i90gv5")},m(i,c){_(i,e,c),I(e,t),I(e,l),I(e,a),s||(r=[Q(e,"click",n[4]),Q(e,"keydown",n[5])],s=!0)},p:q,d(i){i&&u(e),s=!1,ue(r)}}}function tn(n){let e,t,l,a,s;const r=[en,Gl],i=[];function c(f,$){return f[2]?1:0}t=c(n),l=i[t]=r[t](n);let o=!n[2]&&lt(n);return{c(){e=w("div"),l.c(),a=U(),o&&o.c(),this.h()},l(f){e=y(f,"DIV",{class:!0});var $=b(e);l.l($),a=X($),o&&o.l($),$.forEach(u),this.h()},h(){g(e,"class","color-picker svelte-i90gv5")},m(f,$){_(f,e,$),i[t].m(e,null),I(e,a),o&&o.m(e,null),s=!0},p(f,[$]){let m=t;t=c(f),t===m?i[t].p(f,$):(re(),E(i[m],1,1,()=>{i[m]=null}),ie(),l=i[t],l?l.p(f,$):(l=i[t]=r[t](f),l.c()),x(l,1),l.m(e,a)),f[2]?o&&(o.d(1),o=null):o?o.p(f,$):(o=lt(f),o.c(),o.m(e,null))},i(f){s||(x(l),s=!0)},o(f){E(l),s=!1},d(f){f&&u(e),i[t].d(),o&&o.d()}}}function ln(n,e,t){let l,a,s;C(n,Re,$=>t(0,l=$)),C(n,De,$=>t(1,a=$)),C(n,we,$=>t(2,s=$));function r(){let $=a;De.set(l),Re.set($)}function i(){De.set("#ffffff"),Re.set("#000000")}function c($){pe.call(this,n,$)}function o($){pe.call(this,n,$)}function f(){a=this.value,De.set(a)}return[l,a,s,r,i,c,o,f]}class nn extends G{constructor(e){super(),ee(this,e,ln,tn,Z,{})}}function sn(n){let e,t,l,a,s;return t=new nn({}),a=new Xn({props:{value:n[0],options:n[1],onChange:n[2]}}),{c(){e=w("div"),A(t.$$.fragment),l=U(),A(a.$$.fragment),this.h()},l(r){e=y(r,"DIV",{id:!0,class:!0});var i=b(e);T(t.$$.fragment,i),l=X(i),T(a.$$.fragment,i),i.forEach(u),this.h()},h(){g(e,"id","tools"),g(e,"class","svelte-u6k2ef")},m(r,i){_(r,e,i),j(t,e,null),I(e,l),j(a,e,null),s=!0},p(r,[i]){const c={};i&1&&(c.value=r[0]),a.$set(c)},i(r){s||(x(t.$$.fragment,r),x(a.$$.fragment,r),s=!0)},o(r){E(t.$$.fragment,r),E(a.$$.fragment,r),s=!1},d(r){r&&u(e),R(t),R(a)}}}function an(n,e,t){let l;C(n,_e,s=>t(0,l=s));let a=[{value:fe.Brush,icon:"fa-pencil",title:"brush",shortcut:{shift:!0,code:"Digit1"}},{value:fe.Eraser,icon:"fa-eraser",title:"eraser",shortcut:{shift:!0,code:"Digit2"}},{value:fe.Move,icon:"fa-arrows",title:"move",shortcut:{shift:!0,code:"Digit3"}}];return[l,a,s=>_e.set(s)]}class rn extends G{constructor(e){super(),ee(this,e,an,sn,Z,{})}}function nt(n){let e,t,l,a,s,r,i,c,o,f,$,m,h,v,d=n[2]&&st();c=new ae({props:{$$slots:{default:[cn]},$$scope:{ctx:n}}}),c.$on("click",n[6]),f=new ke({});const p=n[3].default,D=ft(p,n,n[8],null);return{c(){e=w("div"),t=w("div"),l=w("header"),a=w("span"),d&&d.c(),s=U(),r=ce(n[1]),i=U(),A(c.$$.fragment),o=U(),A(f.$$.fragment),$=U(),D&&D.c(),this.h()},l(Y){e=y(Y,"DIV",{class:!0});var z=b(e);t=y(z,"DIV",{class:!0});var M=b(t);l=y(M,"HEADER",{class:!0});var N=b(l);a=y(N,"SPAN",{});var J=b(a);d&&d.l(J),s=X(J),r=oe(J,n[1]),J.forEach(u),i=X(N),T(c.$$.fragment,N),N.forEach(u),o=X(M),T(f.$$.fragment,M),$=X(M),D&&D.l(M),M.forEach(u),z.forEach(u),this.h()},h(){g(l,"class","popup-header svelte-1d20gdm"),g(t,"class","popup svelte-1d20gdm"),g(e,"class","overlay svelte-1d20gdm")},m(Y,z){_(Y,e,z),I(e,t),I(t,l),I(l,a),d&&d.m(a,null),I(a,s),I(a,r),I(l,i),j(c,l,null),I(t,o),j(f,t,null),I(t,$),D&&D.m(t,null),m=!0,h||(v=[Q(t,"click",fn),Q(t,"keydown",n[5]),Q(e,"click",n[7]),Q(e,"keydown",n[4])],h=!0)},p(Y,z){Y[2]?d||(d=st(),d.c(),d.m(a,s)):d&&(d.d(1),d=null),(!m||z&2)&&ge(r,Y[1]);const M={};z&256&&(M.$$scope={dirty:z,ctx:Y}),c.$set(M),D&&D.p&&(!m||z&256)&&$t(D,p,Y,Y[8],m?ht(p,Y[8],z,null):ut(Y[8]),null)},i(Y){m||(x(c.$$.fragment,Y),x(f.$$.fragment,Y),x(D,Y),m=!0)},o(Y){E(c.$$.fragment,Y),E(f.$$.fragment,Y),E(D,Y),m=!1},d(Y){Y&&u(e),d&&d.d(),R(c),R(f),D&&D.d(Y),h=!1,ue(v)}}}function st(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-exclamation-triangle")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function cn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-times")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function on(n){let e,t,l=n[0]&&nt(n);return{c(){l&&l.c(),e=se()},l(a){l&&l.l(a),e=se()},m(a,s){l&&l.m(a,s),_(a,e,s),t=!0},p(a,[s]){a[0]?l?(l.p(a,s),s&1&&x(l,1)):(l=nt(a),l.c(),x(l,1),l.m(e.parentNode,e)):l&&(re(),E(l,1,1,()=>{l=null}),ie())},i(a){t||(x(l),t=!0)},o(a){E(l),t=!1},d(a){l&&l.d(a),a&&u(e)}}}const fn=n=>n.stopImmediatePropagation();function $n(n,e,t){let{$$slots:l={},$$scope:a}=e,{show:s=!1}=e,{title:r=""}=e,{isError:i=!0}=e;function c(m){pe.call(this,n,m)}function o(m){pe.call(this,n,m)}const f=()=>t(0,s=!1),$=()=>t(0,s=!1);return n.$$set=m=>{"show"in m&&t(0,s=m.show),"title"in m&&t(1,r=m.title),"isError"in m&&t(2,i=m.isError),"$$scope"in m&&t(8,a=m.$$scope)},[s,r,i,l,c,o,f,$,a]}class un extends G{constructor(e){super(),ee(this,e,$n,on,Z,{show:0,title:1,isError:2})}}function hn(n){let e,t;return e=new Bt({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function dn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-download")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function mn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-arrow-left")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function gn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){g(e,"class","fa fa-arrow-right")},m(t,l){_(t,e,l)},p:q,d(t){t&&u(e)}}}function pn(n){let e,t,l,a;return e=new ae({props:{disabled:!n[2],title:"undo",$$slots:{default:[mn]},$$scope:{ctx:n}}}),e.$on("click",O.undo),l=new ae({props:{disabled:!n[3],title:"redo",$$slots:{default:[gn]},$$scope:{ctx:n}}}),l.$on("click",O.redo),{c(){A(e.$$.fragment),t=U(),A(l.$$.fragment)},l(s){T(e.$$.fragment,s),t=X(s),T(l.$$.fragment,s)},m(s,r){j(e,s,r),_(s,t,r),j(l,s,r),a=!0},p(s,r){const i={};r&4&&(i.disabled=!s[2]),r&1024&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const c={};r&8&&(c.disabled=!s[3]),r&1024&&(c.$$scope={dirty:r,ctx:s}),l.$set(c)},i(s){a||(x(e.$$.fragment,s),x(l.$$.fragment,s),a=!0)},o(s){E(e.$$.fragment,s),E(l.$$.fragment,s),a=!1},d(s){R(e,s),s&&u(t),R(l,s)}}}function vn(n){let e,t;return e=new Zl({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function wn(n){let e,t;return e=new jl({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function yn(n){let e,t,l,a,s,r,i,c,o,f,$,m,h,v,d,p,D,Y,z,M,N,J,L,S,B,H,P;function k(V){n[5](V)}let K={$$slots:{default:[hn]},$$scope:{ctx:n}};return n[0]!==void 0&&(K.show=n[0]),t=new un({props:K}),le.push(()=>he(t,"show",k)),o=new ze({props:{value:n[1],title:"blender",options:[{key:"Software",value:"Software"},{key:"WebGL",value:"WebGL"}]}}),o.$on("change",n[6]),$=new ae({props:{title:"download",$$slots:{default:[dn]},$$scope:{ctx:n}}}),$.$on("click",n[4]),h=new ye({props:{$$slots:{default:[pn]},$$scope:{ctx:n}}}),d=new ke({}),D=new rn({}),z=new xt({props:{$$slots:{default:[vn]},$$scope:{ctx:n}}}),N=new xt({props:{$$slots:{default:[wn]},$$scope:{ctx:n}}}),B=new Ut({}),{c(){e=w("div"),A(t.$$.fragment),a=U(),s=w("div"),r=w("div"),i=U(),c=w("div"),A(o.$$.fragment),f=U(),A($.$$.fragment),m=U(),A(h.$$.fragment),v=U(),A(d.$$.fragment),p=U(),A(D.$$.fragment),Y=U(),A(z.$$.fragment),M=U(),A(N.$$.fragment),J=U(),L=w("div"),S=U(),A(B.$$.fragment),H=ce(`
*/`),this.h()},l(V){e=y(V,"DIV",{class:!0});var F=b(e);T(t.$$.fragment,F),a=X(F),s=y(F,"DIV",{id:!0,class:!0});var W=b(s);r=y(W,"DIV",{}),b(r).forEach(u),i=X(W),c=y(W,"DIV",{class:!0});var te=b(c);T(o.$$.fragment,te),f=X(te),T($.$$.fragment,te),m=X(te),T(h.$$.fragment,te),te.forEach(u),v=X(W),T(d.$$.fragment,W),p=X(W),T(D.$$.fragment,W),Y=X(W),T(z.$$.fragment,W),M=X(W),T(N.$$.fragment,W),J=X(W),L=y(W,"DIV",{}),b(L).forEach(u),W.forEach(u),S=X(F),T(B.$$.fragment,F),F.forEach(u),H=oe(V,`
*/`),this.h()},h(){g(c,"class","top-tooling svelte-1jrj0si"),g(s,"id","sidebar"),g(s,"class","svelte-1jrj0si"),g(e,"class","layout svelte-1jrj0si")},m(V,F){_(V,e,F),j(t,e,null),I(e,a),I(e,s),I(s,r),I(s,i),I(s,c),j(o,c,null),I(c,f),j($,c,null),I(c,m),j(h,c,null),I(s,v),j(d,s,null),I(s,p),j(D,s,null),I(s,Y),j(z,s,null),I(s,M),j(N,s,null),I(s,J),I(s,L),I(e,S),j(B,e,null),_(V,H,F),P=!0},p(V,[F]){const W={};F&1024&&(W.$$scope={dirty:F,ctx:V}),!l&&F&1&&(l=!0,W.show=V[0],de(()=>l=!1)),t.$set(W);const te={};F&2&&(te.value=V[1]),o.$set(te);const at={};F&1024&&(at.$$scope={dirty:F,ctx:V}),$.$set(at);const rt={};F&1036&&(rt.$$scope={dirty:F,ctx:V}),h.$set(rt);const it={};F&1024&&(it.$$scope={dirty:F,ctx:V}),z.$set(it);const ct={};F&1024&&(ct.$$scope={dirty:F,ctx:V}),N.$set(ct)},i(V){P||(x(t.$$.fragment,V),x(o.$$.fragment,V),x($.$$.fragment,V),x(h.$$.fragment,V),x(d.$$.fragment,V),x(D.$$.fragment,V),x(z.$$.fragment,V),x(N.$$.fragment,V),x(B.$$.fragment,V),P=!0)},o(V){E(t.$$.fragment,V),E(o.$$.fragment,V),E($.$$.fragment,V),E(h.$$.fragment,V),E(d.$$.fragment,V),E(D.$$.fragment,V),E(z.$$.fragment,V),E(N.$$.fragment,V),E(B.$$.fragment,V),P=!1},d(V){V&&u(e),R(t),R(o),R($),R(h),R(d),R(D),R(z),R(N),R(B),V&&u(H)}}}function xn(n){let e=window.atob(n),t=e.length,l=new Uint8Array(t);for(let a=0;a<t;a++){let s=e.charCodeAt(a);l[a]=s}return l}function En(n,e,t){let l=document.createElement("canvas");return l.width=e,l.height=t,l.getContext("2d").putImageData(n,0,0),l.toDataURL("image/png").slice(22)}function bn(n,e){let t=document.createElement("a");document.body.appendChild(t),t.href=e,t.download=n,t.click(),t.remove()}function In(n,e,t){let l,a,s,r,i;C(n,Ae,m=>t(7,l=m)),C(n,Ie,m=>t(8,a=m)),C(n,Mn,m=>t(1,s=m)),C(n,Sn,m=>t(2,r=m)),C(n,Jn,m=>t(3,i=m));const c={types:[{description:"Image file (png)",accept:{"image/png":[".png"]}}],suggestedName:"result.png"};async function o(){let m=a.img_size.width,h=a.img_size.height,v=l.nodes[l.root].value.pointer,d=O.get_content_of(v,m,h),p=new ImageData(d,m,h),D=En(p,m,h),Y=xn(D),z=new Blob([Y],{type:"image/png"}),M=window.URL.createObjectURL(z),N=window.showSaveFilePicker;if(N)try{const J=await(await N(c)).createWritable();await J.write(z),J.close()}catch{}else bn("result.png",M);window.URL.revokeObjectURL(M)}let f=!1;function $(m){f=m,t(0,f)}return[f,s,r,i,o,$,m=>O.switch_blender(m.target.value)]}class _n extends G{constructor(e){super(),ee(this,e,In,yn,Z,{})}}function Dn(n){let e,t;return e=new _n({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},p:q,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function kn(n,e,t){let l;C(n,mt,i=>t(0,l=i));const a=i=>new Promise(c=>setTimeout(c,i)),s=new URLSearchParams(window.location.search);let r=async()=>{let i=parseInt(s.get("w"))||2e3,c=parseInt(s.get("h"))||1500;s.delete("w"),s.delete("h"),await a(500),await O.init(i,c),we.set(!1),Ie.set(new qn(i,c,100,100,10))};return Ee(async()=>{r(),Bn()}),n.$$.update=()=>{n.$$.dirty&1&&localStorage.setItem("colorscheme",l)},[l]}class Pn extends G{constructor(e){super(),ee(this,e,kn,Dn,Z,{})}}function Vn(n){let e,t;return e=new Pn({}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}function zn(n){let e,t;return e=new Fn({props:{$$slots:{default:[Vn]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(l){T(e.$$.fragment,l)},m(l,a){j(e,l,a),t=!0},p(l,[a]){const s={};a&1&&(s.$$scope={dirty:a,ctx:l}),e.$set(s)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){R(e,l)}}}Et=class extends G{constructor(n){super(),ee(this,n,null,zn,Z,{})}}});export{Kn as __tla,Et as component};
