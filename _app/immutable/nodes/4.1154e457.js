import{S as ee,i as te,s as j,k as w,l as y,m as b,h as u,n as p,b as _,D as B,E as F,o as Ie,w as ne,y as A,z as P,C as I,A as U,g as x,d as E,B as T,e as ae,v as ie,f as ce,a as Y,c as L,L as ut,p as se,M as Rn,N as O,O as de,F as ht,G as dt,H as mt,I as pt,q as oe,r as fe,J as _e,u as ve,P as we,Q as Yn,R as gt,T as Ln,U as ze,V as Sn,W as me,X as pe,Y as Gn,K as Mn}from"../chunks/index.c219bad8.js";import{d as Bn,c as Jn,u as Ne,e as H,S as ye,t as ke,s as xe,T as ue,f as vt,h as wt,g as ge,B as re,j as Ce,l as Ue,k as he,m as Ve,n as Te,o as Re,r as yt,p as xt,q as Et,v as bt,M as It,w as Ye,V as Xn,a as _t,x as qn,y as Fn,z as On,b as Qn,__tla as Wn}from"../chunks/VisualSwitch.9f8b02bc.js";import{b as Zn}from"../chunks/paths.065d899a.js";let kt,Hn=Promise.all([(()=>{try{return Wn}catch{}})()]).then(async()=>{function Vt(n){let e;return{c(){e=w("canvas"),this.h()},l(t){e=y(t,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),b(e).forEach(u),this.h()},h(){p(e,"id","canvas-overlay"),p(e,"width",n[0]),p(e,"height",n[1]),p(e,"class","svelte-qfx333")},m(t,l){_(t,e,l),n[6](e)},p(t,[l]){l&1&&p(e,"width",t[0]),l&2&&p(e,"height",t[1])},i:B,o:B,d(t){t&&u(e),n[6](null)}}}function Dt(n,e,t){let l,a,s;F(n,Bn,v=>t(4,l=v)),F(n,Jn,v=>t(5,a=v)),F(n,Ne,v=>t(8,s=v));let{width:r}=e,{height:i}=e,c,o="#000";function f(){if(!c)return;const v=c.getContext("2d");v&&(v.clearRect(0,0,r,i),$(v),m(v))}function $(v){v.fillStyle=o,v.fillRect(0,0,r,i),v.clearRect(s.position.x,s.position.y,s.img_size.width*s.scale,s.img_size.height*s.scale)}function m(v){v.fillStyle="#FF0000",v.beginPath(),v.moveTo(s.position.x,s.position.y),v.lineTo(s.position.x+s.img_size.width*s.scale,s.position.y),v.lineTo(s.position.x+s.img_size.width*s.scale,s.position.y+s.img_size.height*s.scale),v.lineTo(s.position.x,s.position.y+s.img_size.height*s.scale),v.lineTo(s.position.x,s.position.y),v.stroke()}function d(){f()}function g(...v){setTimeout(()=>{o=getComputedStyle(document.documentElement).getPropertyValue("--color-lighter"),f()},100)}Ie(()=>{f(),g(),H.add_redraw_callback(f)});function h(v){ne[v?"unshift":"push"](()=>{c=v,t(2,c)})}return n.$$set=v=>{"width"in v&&t(0,r=v.width),"height"in v&&t(1,i=v.height)},n.$$.update=()=>{n.$$.dirty&1&&r&&d(),n.$$.dirty&2&&i&&d(),n.$$.dirty&48&&g(a,l)},[r,i,c,f,l,a,h]}class zt extends ee{constructor(e){super(),te(this,e,Dt,Vt,j,{width:0,height:1,redraw:3})}get redraw(){return this.$$.ctx[3]}}function Nt(n){let e;return{c(){e=w("canvas"),this.h()},l(t){e=y(t,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),b(e).forEach(u),this.h()},h(){p(e,"id","canvas-alpha-pattern"),p(e,"width",n[0]),p(e,"height",n[1]),p(e,"class","svelte-qfx333")},m(t,l){_(t,e,l),n[4](e)},p(t,[l]){l&1&&p(e,"width",t[0]),l&2&&p(e,"height",t[1])},i:B,o:B,d(t){t&&u(e),n[4](null)}}}function Ct(n,e,t){let{width:l}=e,{height:a}=e,s,r;function i(){r=document.createElement("canvas");let f=32;r.width=f,r.height=f;let $=r.getContext("2d");$.fillStyle="#eee",$.fillRect(0,0,f,f),$.fillStyle="#ccc",$.fillRect(0,0,f/2,f/2),$.fillRect(f/2,f/2,f/2,f/2)}function c(){if(!s)return;let f=s.getContext("2d");if(!f)return;f.beginPath();let $=f.createPattern(r,"repeat");f.fillStyle=$,f.fillRect(0,0,l,a)}Ie(()=>{i(),c()});function o(f){ne[f?"unshift":"push"](()=>{s=f,t(2,s)})}return n.$$set=f=>{"width"in f&&t(0,l=f.width),"height"in f&&t(1,a=f.height)},[l,a,s,c,o]}class Le extends ee{constructor(e){super(),te(this,e,Ct,Nt,j,{width:0,height:1,redraw:3})}get redraw(){return this.$$.ctx[3]}}function At(n){let e,t,l,a;return l=new ye({}),{c(){e=w("div"),t=w("div"),A(l.$$.fragment),this.h()},l(s){e=y(s,"DIV",{class:!0});var r=b(e);t=y(r,"DIV",{class:!0});var i=b(t);P(l.$$.fragment,i),i.forEach(u),r.forEach(u),this.h()},h(){p(t,"class","skeleton-image svelte-rlche6"),p(e,"class","box svelte-rlche6")},m(s,r){_(s,e,r),I(e,t),U(l,t,null),a=!0},p:B,i(s){a||(x(l.$$.fragment,s),a=!0)},o(s){E(l.$$.fragment,s),a=!1},d(s){s&&u(e),T(l)}}}class Pt extends ee{constructor(e){super(),te(this,e,null,At,j,{})}}function Ut(n){let e;return{c(){e=w("canvas"),this.h()},l(t){e=y(t,"CANVAS",{id:!0,width:!0,height:!0,class:!0}),b(e).forEach(u),this.h()},h(){p(e,"id","canvas-content"),p(e,"width",n[0]),p(e,"height",n[1]),p(e,"class","svelte-qfx333")},m(t,l){_(t,e,l),n[4](e)},p(t,[l]){l&1&&p(e,"width",t[0]),l&2&&p(e,"height",t[1])},i:B,o:B,d(t){t&&u(e),n[4](null)}}}function Tt(n,e,t){let l;F(n,Ne,d=>t(8,l=d));let{width:a}=e,{height:s}=e,r,i,c,o;function f(){if(!c)return;let d;try{d=H.content_as_bytes()}catch{return}let g=new ImageData(d,l.img_size.width,l.img_size.height);o=i.getContext("2d"),o.imageSmoothingEnabled=!1,o.clearRect(0,0,i.width,i.height),o.putImageData(g,0,0),c.imageSmoothingEnabled=!1,c.clearRect(0,0,r.width,r.height);let h=l.scale;c.drawImage(i,l.position.x,l.position.y,l.img_size.width*h,l.img_size.height*h)}Ie(()=>{c=r.getContext("2d"),i=document.createElement("canvas"),f(),$(),H.add_redraw_callback(f)});function $(){l.set_canvas_size(a,s),l.center(),i&&(i.width=l.img_size.width,i.height=l.img_size.height,o=i.getContext("2d")),f()}function m(d){ne[d?"unshift":"push"](()=>{r=d,t(2,r)})}return n.$$set=d=>{"width"in d&&t(0,a=d.width),"height"in d&&t(1,s=d.height)},n.$$.update=()=>{n.$$.dirty&1&&a&&$(),n.$$.dirty&2&&s&&$()},[a,s,r,f,m]}class Rt extends ee{constructor(e){super(),te(this,e,Tt,Ut,j,{width:0,height:1,redraw:3})}get redraw(){return this.$$.ctx[3]}}function Yt(n){let e,t;return e=new Pt({}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},p:B,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function Lt(n){let e,t,l,a,s,r,i,c,o,f,$={height:n[0],width:n[1]};t=new Le({props:$}),n[14](t);let m={height:n[0],width:n[1]};a=new Rt({props:m}),n[15](a);let d={height:n[0],width:n[1]};return r=new zt({props:d}),n[16](r),{c(){e=w("div"),A(t.$$.fragment),l=Y(),A(a.$$.fragment),s=Y(),A(r.$$.fragment),this.h()},l(g){e=y(g,"DIV",{class:!0});var h=b(e);P(t.$$.fragment,h),l=L(h),P(a.$$.fragment,h),s=L(h),P(r.$$.fragment,h),h.forEach(u),this.h()},h(){p(e,"class","wrapper svelte-e86aa8"),ut(()=>n[17].call(e)),se(e,"cursor",n[5])},m(g,h){_(g,e,h),U(t,e,null),I(e,l),U(a,e,null),I(e,s),U(r,e,null),i=Rn(e,n[17].bind(e)),c=!0,o||(f=[O(e,"wheel",n[7]),O(e,"mousemove",n[10]),O(e,"pointerdown",n[8]),O(e,"pointerup",n[9]),O(e,"pointerleave",n[11]),O(e,"contextmenu",Gt)],o=!0)},p(g,h){const v={};h&1&&(v.height=g[0]),h&2&&(v.width=g[1]),t.$set(v);const V={};h&1&&(V.height=g[0]),h&2&&(V.width=g[1]),a.$set(V);const R={};h&1&&(R.height=g[0]),h&2&&(R.width=g[1]),r.$set(R),h&32&&se(e,"cursor",g[5])},i(g){c||(x(t.$$.fragment,g),x(a.$$.fragment,g),x(r.$$.fragment,g),c=!0)},o(g){E(t.$$.fragment,g),E(a.$$.fragment,g),E(r.$$.fragment,g),c=!1},d(g){g&&u(e),n[14](null),T(t),n[15](null),T(a),n[16](null),T(r),i(),o=!1,de(f)}}}function St(n){let e,t,l,a;const s=[Lt,Yt],r=[];function i(c,o){return c[6]?1:0}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=ae()},l(c){t.l(c),l=ae()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(ie(),E(r[f],1,1,()=>{r[f]=null}),ce(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function Gt(n){n.preventDefault()}function Mt(n,e,t){let l,a,s;F(n,ke,D=>t(20,l=D)),F(n,Ne,D=>t(21,a=D)),F(n,xe,D=>t(6,s=D));let r,i,c,o,f;async function $(){f&&f.redraw(),c.redraw(),o.redraw()}function m(D){let k=D.deltaY<0?1.05:.95,[q,W]=[D.offsetX,D.offsetY];a.zoom_at_position(q,W,k),$()}var d=(D=>(D.None="none",D.Main="main",D.Drag="drag",D))(d||{});let g="none",h,v;function V(D){if(D.button===0){let k=a.translate_position(D.offsetX,D.offsetY);t(13,g="main");let q=k[0],W=k[1];H.start(k[0],k[1]);let K=a.translate_position(h,v),M=K[0],Z=K[1];H.extend(q,W,M,Z)}else t(13,g="drag")}function R(D){D.preventDefault(),t(13,g="none");let k=a.translate_position(D.offsetX,D.offsetY),q=k[0],W=k[1],K=a.translate_position(h,v),M=K[0],Z=K[1];H.extend(q,W,M,Z),setTimeout(()=>{H.finish(),$()},0)}function N(D){if(D.preventDefault(),g==="drag")h&&v&&a.move_relative(D.offsetX-h,D.offsetY-v);else if(g==="main"){let k=a.translate_position(D.offsetX,D.offsetY),q=a.translate_position(h,v),W=k[0],K=k[1],M=q[0],Z=q[1];H.extend(W,K,M,Z)}else{h=D.offsetX,v=D.offsetY;return}$(),h=D.offsetX,v=D.offsetY}function G(){g==="main"&&H.finish(),t(13,g="none")}let z;function J(D){switch(D){case"main":return l===ue.Move?"move":"default";case"drag":return"grab";default:return"default"}}function C(D){ne[D?"unshift":"push"](()=>{o=D,t(3,o)})}function S(D){ne[D?"unshift":"push"](()=>{f=D,t(4,f)})}function X(D){ne[D?"unshift":"push"](()=>{c=D,t(2,c)})}function Q(){r=this.clientHeight,i=this.clientWidth,t(0,r),t(1,i)}return n.$$.update=()=>{n.$$.dirty&8192&&t(5,z=J(g))},[r,i,c,o,f,z,s,m,V,R,N,G,$,g,C,S,X,Q]}class Bt extends ee{constructor(e){super(),te(this,e,Mt,St,j,{redraw:12})}get redraw(){return this.$$.ctx[12]}}function Jt(n){let e,t;const l=n[1].default,a=ht(l,n,n[0],null);return{c(){e=w("div"),a&&a.c(),this.h()},l(s){e=y(s,"DIV",{class:!0});var r=b(e);a&&a.l(r),r.forEach(u),this.h()},h(){p(e,"class","box svelte-l7yypc")},m(s,r){_(s,e,r),a&&a.m(e,null),t=!0},p(s,[r]){a&&a.p&&(!t||r&1)&&dt(a,l,s,s[0],t?pt(l,s[0],r,null):mt(s[0]),null)},i(s){t||(x(a,s),t=!0)},o(s){E(a,s),t=!1},d(s){s&&u(e),a&&a.d(s)}}}function Xt(n,e,t){let{$$slots:l={},$$scope:a}=e;return n.$$set=s=>{"$$scope"in s&&t(0,a=s.$$scope)},[a,l]}class Ee extends ee{constructor(e){super(),te(this,e,Xt,Jt,j,{})}}function Se(n,e,t){const l=n.slice();l[4]=e[t],l[7]=t;const a=l[1].nodes[l[0].length-1-l[7]];return l[5]=a,l}function Ge(n){let e,t=n[5].id+"",l,a,s=n[5].value.data.type+"",r;return{c(){e=w("li"),l=oe(t),a=oe(", "),r=oe(s)},l(i){e=y(i,"LI",{});var c=b(e);l=fe(c,t),a=fe(c,", "),r=fe(c,s),c.forEach(u)},m(i,c){_(i,e,c),I(e,l),I(e,a),I(e,r)},p(i,c){c&3&&t!==(t=i[5].id+"")&&ve(l,t),c&3&&s!==(s=i[5].value.data.type+"")&&ve(r,s)},d(i){i&&u(e)}}}function qt(n){let e,t,l,a,s={length:n[0].length},r=[];for(let i=0;i<s.length;i+=1)r[i]=Ge(Se(n,s,i));return{c(){e=w("span"),t=oe("History:"),l=Y(),a=w("ul");for(let i=0;i<r.length;i+=1)r[i].c()},l(i){e=y(i,"SPAN",{});var c=b(e);t=fe(c,"History:"),c.forEach(u),l=L(i),a=y(i,"UL",{});var o=b(a);for(let f=0;f<r.length;f+=1)r[f].l(o);o.forEach(u)},m(i,c){_(i,e,c),I(e,t),_(i,l,c),_(i,a,c);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(a,null)},p(i,[c]){if(c&3){s={length:i[0].length};let o;for(o=0;o<s.length;o+=1){const f=Se(i,s,o);r[o]?r[o].p(f,c):(r[o]=Ge(f),r[o].c(),r[o].m(a,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}},i:B,o:B,d(i){i&&u(e),i&&u(l),i&&u(a),_e(r,i)}}}function Ft(n,e,t){let l,a;F(n,vt,i=>t(2,l=i)),F(n,wt,i=>t(1,a=i));function s(i){if(!a)return[];function c(o,f){return o===a.root?f.concat([o]):c(a.nodes[o].parent,f.concat([o]))}return c(i,[])}let r;return n.$$.update=()=>{n.$$.dirty&4&&t(0,r=s(l))},[r,a,l]}class Ot extends ee{constructor(e){super(),te(this,e,Ft,qt,j,{})}}function Qt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-folder")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function Wt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-file")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function Zt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-image")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function Ht(n){let e,t,l,a,s,r,i,c,o,f,$;return e=new re({props:{$$slots:{default:[Qt]},$$scope:{ctx:n}}}),e.$on("click",n[2]),l=new re({props:{$$slots:{default:[Wt]},$$scope:{ctx:n}}}),l.$on("click",n[1]),c=new re({props:{style:"pointer-events: none",$$slots:{default:[Zt]},$$scope:{ctx:n}}}),c.$on("click",rl),{c(){A(e.$$.fragment),t=Y(),A(l.$$.fragment),a=Y(),s=w("label"),r=w("input"),i=Y(),A(c.$$.fragment),this.h()},l(m){P(e.$$.fragment,m),t=L(m),P(l.$$.fragment,m),a=L(m),s=y(m,"LABEL",{for:!0});var d=b(s);r=y(d,"INPUT",{type:!0,id:!0,style:!0,name:!0}),i=L(d),P(c.$$.fragment,d),d.forEach(u),this.h()},h(){p(r,"type","file"),p(r,"id","myfile"),se(r,"display","none"),p(r,"name","myfile"),p(s,"for","myfile")},m(m,d){U(e,m,d),_(m,t,d),U(l,m,d),_(m,a,d),_(m,s,d),I(s,r),I(s,i),U(c,s,null),o=!0,f||($=O(r,"change",n[4]),f=!0)},p(m,d){const g={};d&1024&&(g.$$scope={dirty:d,ctx:m}),e.$set(g);const h={};d&1024&&(h.$$scope={dirty:d,ctx:m}),l.$set(h);const v={};d&1024&&(v.$$scope={dirty:d,ctx:m}),c.$set(v)},i(m){o||(x(e.$$.fragment,m),x(l.$$.fragment,m),x(c.$$.fragment,m),o=!0)},o(m){E(e.$$.fragment,m),E(l.$$.fragment,m),E(c.$$.fragment,m),o=!1},d(m){T(e,m),m&&u(t),T(l,m),m&&u(a),m&&u(s),T(c),f=!1,$()}}}function jt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-arrow-up")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function Kt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-arrow-down")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function el(n){let e,t,l,a;return e=new re({props:{disabled:n[0],$$slots:{default:[jt]},$$scope:{ctx:n}}}),e.$on("click",n[5]),l=new re({props:{disabled:n[0],$$slots:{default:[Kt]},$$scope:{ctx:n}}}),l.$on("click",n[6]),{c(){A(e.$$.fragment),t=Y(),A(l.$$.fragment)},l(s){P(e.$$.fragment,s),t=L(s),P(l.$$.fragment,s)},m(s,r){U(e,s,r),_(s,t,r),U(l,s,r),a=!0},p(s,r){const i={};r&1&&(i.disabled=s[0]),r&1024&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const c={};r&1&&(c.disabled=s[0]),r&1024&&(c.$$scope={dirty:r,ctx:s}),l.$set(c)},i(s){a||(x(e.$$.fragment,s),x(l.$$.fragment,s),a=!0)},o(s){E(e.$$.fragment,s),E(l.$$.fragment,s),a=!1},d(s){T(e,s),s&&u(t),T(l,s)}}}function tl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-trash")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function ll(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-random")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function nl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-copy")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function sl(n){let e,t,l,a,s,r;return e=new re({props:{disabled:n[0],$$slots:{default:[tl]},$$scope:{ctx:n}}}),e.$on("click",n[3]),l=new re({props:{disabled:n[0],$$slots:{default:[ll]},$$scope:{ctx:n}}}),l.$on("click",n[7]),s=new re({props:{disabled:n[0],$$slots:{default:[nl]},$$scope:{ctx:n}}}),s.$on("click",n[8]),{c(){A(e.$$.fragment),t=Y(),A(l.$$.fragment),a=Y(),A(s.$$.fragment)},l(i){P(e.$$.fragment,i),t=L(i),P(l.$$.fragment,i),a=L(i),P(s.$$.fragment,i)},m(i,c){U(e,i,c),_(i,t,c),U(l,i,c),_(i,a,c),U(s,i,c),r=!0},p(i,c){const o={};c&1&&(o.disabled=i[0]),c&1024&&(o.$$scope={dirty:c,ctx:i}),e.$set(o);const f={};c&1&&(f.disabled=i[0]),c&1024&&(f.$$scope={dirty:c,ctx:i}),l.$set(f);const $={};c&1&&($.disabled=i[0]),c&1024&&($.$$scope={dirty:c,ctx:i}),s.$set($)},i(i){r||(x(e.$$.fragment,i),x(l.$$.fragment,i),x(s.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),E(l.$$.fragment,i),E(s.$$.fragment,i),r=!1},d(i){T(e,i),i&&u(t),T(l,i),i&&u(a),T(s,i)}}}function al(n){let e,t,l,a,s,r,i;return t=new Ee({props:{$$slots:{default:[Ht]},$$scope:{ctx:n}}}),a=new Ee({props:{$$slots:{default:[el]},$$scope:{ctx:n}}}),r=new Ee({props:{$$slots:{default:[sl]},$$scope:{ctx:n}}}),{c(){e=w("div"),A(t.$$.fragment),l=Y(),A(a.$$.fragment),s=Y(),A(r.$$.fragment),this.h()},l(c){e=y(c,"DIV",{id:!0,class:!0});var o=b(e);P(t.$$.fragment,o),l=L(o),P(a.$$.fragment,o),s=L(o),P(r.$$.fragment,o),o.forEach(u),this.h()},h(){p(e,"id","layer-controls"),p(e,"class","svelte-s3t81j")},m(c,o){_(c,e,o),U(t,e,null),I(e,l),U(a,e,null),I(e,s),U(r,e,null),i=!0},p(c,[o]){const f={};o&1024&&(f.$$scope={dirty:o,ctx:c}),t.$set(f);const $={};o&1025&&($.$$scope={dirty:o,ctx:c}),a.$set($);const m={};o&1025&&(m.$$scope={dirty:o,ctx:c}),r.$set(m)},i(c){i||(x(t.$$.fragment,c),x(a.$$.fragment,c),x(r.$$.fragment,c),i=!0)},o(c){E(t.$$.fragment,c),E(a.$$.fragment,c),E(r.$$.fragment,c),i=!1},d(c){c&&u(e),T(t),T(a),T(r)}}}const rl=()=>{};function il(n,e,t){let l;F(n,ge,d=>t(9,l=d));function a(){if(l.length>1)return;let d=l.length===1?l[0]:0;H.perform_step({type:"layer/create/empty",move_idx:d,position:null})}function s(){if(l.length>1)return;let d=l.length===1?-l[0]:0;H.perform_step({type:"layer/create/group",move_idx:d})}function r(){H.perform_step({type:"layer/remove",ids:l}),ge.set([])}function i(d){let g=d.target.files[0],h=new FileReader;h.readAsDataURL(g),h.onload=v=>{let V=v.target.result;V=V.slice(22),H.perform_step({type:"layer/create/from_data",parent:0,img:{src:"encode/png",data:V}})}}function c(){if(l.length!==1)return;let d=l[0];H.move_layer_up(d)}function o(){if(l.length!==1)return;let d=l[0];H.move_layer_down(d)}function f(){if(l.length!==1)return;let d=l[0];H.perform_step({type:"layer/merge_down",id:d})}function $(){l.length!=0&&H.perform_step({type:"layer/duplicate",id:l[0]})}let m=!0;return n.$$.update=()=>{n.$$.dirty&512&&t(0,m=l.length===0)},[m,a,s,r,i,c,o,f,$,l]}class cl extends ee{constructor(e){super(),te(this,e,il,al,j,{})}}function Me(n,e,t){const l=n.slice();return l[6]=e[t].key,l[0]=e[t].value,l[8]=t,l}function ol(n){let e,t,l;return t=new ye({}),{c(){e=w("div"),A(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);P(t.$$.fragment,s),s.forEach(u),this.h()},h(){p(e,"class","box svelte-1ysb0t1")},m(a,s){_(a,e,s),U(t,e,null),l=!0},p:B,i(a){l||(x(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&u(e),T(t)}}}function fl(n){let e,t,l,a,s,r,i,c,o=n[2],f=[];for(let $=0;$<o.length;$+=1)f[$]=Be(Me(n,o,$));return{c(){e=w("div"),t=w("select");for(let $=0;$<f.length;$+=1)f[$].c();l=Y(),a=w("div"),s=w("span"),r=oe(n[1]),this.h()},l($){e=y($,"DIV",{class:!0});var m=b(e);t=y(m,"SELECT",{class:!0});var d=b(t);for(let v=0;v<f.length;v+=1)f[v].l(d);d.forEach(u),l=L(m),a=y(m,"DIV",{class:!0});var g=b(a);s=y(g,"SPAN",{});var h=b(s);r=fe(h,n[1]),h.forEach(u),g.forEach(u),m.forEach(u),this.h()},h(){p(t,"class","svelte-1ysb0t1"),n[0]===void 0&&ut(()=>n[5].call(t)),p(a,"class","title svelte-1ysb0t1"),p(e,"class","box svelte-1ysb0t1")},m($,m){_($,e,m),I(e,t);for(let d=0;d<f.length;d+=1)f[d]&&f[d].m(t,null);gt(t,n[0],!0),I(e,l),I(e,a),I(a,s),I(s,r),i||(c=[O(t,"change",n[5]),O(t,"change",n[4])],i=!0)},p($,m){if(m&4){o=$[2];let d;for(d=0;d<o.length;d+=1){const g=Me($,o,d);f[d]?f[d].p(g,m):(f[d]=Be(g),f[d].c(),f[d].m(t,null))}for(;d<f.length;d+=1)f[d].d(1);f.length=o.length}m&5&&gt(t,$[0]),m&2&&ve(r,$[1])},i:B,o:B,d($){$&&u(e),_e(f,$),i=!1,de(c)}}}function Be(n){let e,t=n[0]+"",l,a;return{c(){e=w("option"),l=oe(t),this.h()},l(s){e=y(s,"OPTION",{class:!0});var r=b(e);l=fe(r,t),r.forEach(u),this.h()},h(){e.__value=a=n[0],e.value=e.__value,p(e,"class","svelte-1ysb0t1")},m(s,r){_(s,e,r),I(e,l)},p(s,r){r&4&&t!==(t=s[0]+"")&&ve(l,t),r&4&&a!==(a=s[0])&&(e.__value=a,e.value=e.__value)},d(s){s&&u(e)}}}function $l(n){let e,t,l,a;const s=[fl,ol],r=[];function i(c,o){return c[3]?1:0}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=ae()},l(c){t.l(c),l=ae()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(ie(),E(r[f],1,1,()=>{r[f]=null}),ce(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function ul(n,e,t){let l;F(n,xe,o=>t(3,l=o));let{value:a}=e,{title:s}=e,{options:r}=e;function i(o){we.call(this,n,o)}function c(){a=Yn(this),t(0,a),t(2,r)}return n.$$set=o=>{"value"in o&&t(0,a=o.value),"title"in o&&t(1,s=o.title),"options"in o&&t(2,r=o.options)},[a,s,r,l,i,c]}class Ae extends ee{constructor(e){super(),te(this,e,ul,$l,j,{value:0,title:1,options:2})}}function hl(n){let e,t,l,a,s,r,i,c,o,f=n[5](n[0])+"",$,m,d,g,h;return{c(){e=w("div"),t=w("div"),a=Y(),s=w("div"),r=w("span"),i=oe(n[1]),c=Y(),o=w("span"),$=oe(f),m=Y(),d=w("input"),this.h()},l(v){e=y(v,"DIV",{class:!0});var V=b(e);t=y(V,"DIV",{class:!0,style:!0}),b(t).forEach(u),a=L(V),s=y(V,"DIV",{class:!0});var R=b(s);r=y(R,"SPAN",{});var N=b(r);i=fe(N,n[1]),N.forEach(u),c=L(R),o=y(R,"SPAN",{});var G=b(o);$=fe(G,f),G.forEach(u),R.forEach(u),m=L(V),d=y(V,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0,name:!0,id:!0}),V.forEach(u),this.h()},h(){p(t,"class","selected svelte-jbas8z"),p(t,"style",l="width: "+100*n[0]/n[3]+"%"),p(s,"class","overlay svelte-jbas8z"),p(d,"type","range"),p(d,"min",n[2]),p(d,"max",n[3]),p(d,"step",n[4]),p(d,"class","slider svelte-jbas8z"),p(d,"name","slider"),p(d,"id","slider"),p(e,"class","box svelte-jbas8z")},m(v,V){_(v,e,V),I(e,t),I(e,a),I(e,s),I(s,r),I(r,i),I(s,c),I(s,o),I(o,$),I(e,m),I(e,d),ze(d,n[0]),g||(h=[O(d,"change",n[9]),O(d,"input",n[9]),O(e,"wheel",n[7])],g=!0)},p(v,V){V&9&&l!==(l="width: "+100*v[0]/v[3]+"%")&&p(t,"style",l),V&2&&ve(i,v[1]),V&33&&f!==(f=v[5](v[0])+"")&&ve($,f),V&4&&p(d,"min",v[2]),V&8&&p(d,"max",v[3]),V&16&&p(d,"step",v[4]),V&1&&ze(d,v[0])},i:B,o:B,d(v){v&&u(e),g=!1,de(h)}}}function dl(n){let e,t,l;return t=new ye({}),{c(){e=w("div"),A(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);P(t.$$.fragment,s),s.forEach(u),this.h()},h(){p(e,"class","box svelte-jbas8z")},m(a,s){_(a,e,s),U(t,e,null),l=!0},p:B,i(a){l||(x(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&u(e),T(t)}}}function ml(n){let e,t,l,a;const s=[dl,hl],r=[];function i(c,o){return c[6]?0:1}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=ae()},l(c){t.l(c),l=ae()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(ie(),E(r[f],1,1,()=>{r[f]=null}),ce(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function pl(n,e,t){let l;F(n,xe,d=>t(6,l=d));let{value:a}=e,{name:s}=e,{min:r}=e,{max:i}=e,{step:c=1}=e,{delta:o=.07}=e,{fmt:f=d=>d}=e;function $(d){d.deltaY>0?t(0,a=Math.max(a-i*o,r)):d.deltaY<0&&t(0,a=Math.min(a+i*o,i)),t(0,a=Math.round(1e6*a)/1e6)}function m(){a=Ln(this.value),t(0,a)}return n.$$set=d=>{"value"in d&&t(0,a=d.value),"name"in d&&t(1,s=d.name),"min"in d&&t(2,r=d.min),"max"in d&&t(3,i=d.max),"step"in d&&t(4,c=d.step),"delta"in d&&t(8,o=d.delta),"fmt"in d&&t(5,f=d.fmt)},[a,s,r,i,c,f,l,$,o,m]}class be extends ee{constructor(e){super(),te(this,e,pl,ml,j,{value:0,name:1,min:2,max:3,step:4,delta:8,fmt:5})}}function Je(n,e,t){const l=n.slice();return l[1]=e[t],l[3]=t,l}function Xe(n){let e;return{c(){e=w("div"),this.h()},l(t){e=y(t,"DIV",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","delimiter svelte-p5s2tt")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function gl(n){let e,t={length:n[0]},l=[];for(let a=0;a<t.length;a+=1)l[a]=Xe(Je(n,t,a));return{c(){e=w("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);for(let r=0;r<l.length;r+=1)l[r].l(s);s.forEach(u),this.h()},h(){p(e,"class","level svelte-p5s2tt")},m(a,s){_(a,e,s);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(a,[s]){if(s&1){t={length:a[0]};let r;for(r=0;r<t.length;r+=1){const i=Je(a,t,r);l[r]?l[r].p(i,s):(l[r]=Xe(),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},i:B,o:B,d(a){a&&u(e),_e(l,a)}}}function vl(n,e,t){let{level:l}=e;return n.$$set=a=>{"level"in a&&t(0,l=a.level)},[l]}class Pe extends ee{constructor(e){super(),te(this,e,vl,gl,j,{level:0})}}function qe(n){let e,t,l,a,s,r=!n[1]&&Fe();return{c(){r&&r.c(),e=Y(),t=w("div"),this.h()},l(i){r&&r.l(i),e=L(i),t=y(i,"DIV",{class:!0,style:!0}),b(t).forEach(u),this.h()},h(){p(t,"class","indicator svelte-183lf69"),p(t,"style",l=`background: ${n[1]?"darkgray":"transparent"};`)},m(i,c){r&&r.m(i,c),_(i,e,c),_(i,t,c),a||(s=[O(t,"dragover",n[3]),O(t,"dragleave",n[4]),O(t,"drop",n[5])],a=!0)},p(i,c){i[1]?r&&(r.d(1),r=null):r||(r=Fe(),r.c(),r.m(e.parentNode,e)),c&2&&l!==(l=`background: ${i[1]?"darkgray":"transparent"};`)&&p(t,"style",l)},d(i){r&&r.d(i),i&&u(e),i&&u(t),a=!1,de(s)}}}function Fe(n){let e;return{c(){e=w("div"),this.h()},l(t){e=y(t,"DIV",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","small-indicator svelte-183lf69")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function wl(n){let e,t,l,a;t=new Pe({props:{level:n[0]}});let s=n[2]&&qe(n);return{c(){e=w("div"),A(t.$$.fragment),l=Y(),s&&s.c(),this.h()},l(r){e=y(r,"DIV",{class:!0});var i=b(e);P(t.$$.fragment,i),l=L(i),s&&s.l(i),i.forEach(u),this.h()},h(){p(e,"class","box svelte-183lf69")},m(r,i){_(r,e,i),U(t,e,null),I(e,l),s&&s.m(e,null),a=!0},p(r,[i]){const c={};i&1&&(c.level=r[0]),t.$set(c),r[2]?s?s.p(r,i):(s=qe(r),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},i(r){a||(x(t.$$.fragment,r),a=!0)},o(r){E(t.$$.fragment,r),a=!1},d(r){r&&u(e),T(t),s&&s.d()}}}function yl(n,e,t){let l;F(n,Ce,f=>t(2,l=f));let{move_idx:a}=e,{level:s}=e,r=!1;function i(f){f.preventDefault(),t(1,r=!0)}function c(f){t(1,r=!1)}function o(f){let $=l;$!=null&&(H.perform_step({type:"layer/move",id:$,move_idx:a}),Ce.set(null))}return n.$$set=f=>{"move_idx"in f&&t(6,a=f.move_idx),"level"in f&&t(0,s=f.level)},n.$$.update=()=>{n.$$.dirty&6&&t(1,r=l?r:!1)},[s,r,l,i,c,o,a]}class Oe extends ee{constructor(e){super(),te(this,e,yl,wl,j,{move_idx:6,level:0})}}function Qe(n){let e;function t(s,r){return s[3]?El:xl}let l=t(n),a=l(n);return{c(){a.c(),e=ae()},l(s){a.l(s),e=ae()},m(s,r){a.m(s,r),_(s,e,r)},p(s,r){l!==(l=t(s))&&(a.d(1),a=l(s),a&&(a.c(),a.m(e.parentNode,e)))},d(s){a.d(s),s&&u(e)}}}function xl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-chevron-right")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function El(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-chevron-down")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function We(n){let e,t,l;function a(i,c){return i[0].value.visible?Il:bl}let s=a(n),r=s(n);return{c(){e=w("button"),r.c(),this.h()},l(i){e=y(i,"BUTTON",{class:!0});var c=b(e);r.l(c),c.forEach(u),this.h()},h(){p(e,"class","visibility svelte-ve4xfc")},m(i,c){_(i,e,c),r.m(e,null),t||(l=O(e,"click",n[7]),t=!0)},p(i,c){s!==(s=a(i))&&(r.d(1),r=s(i),r&&(r.c(),r.m(e,null)))},d(i){i&&u(e),r.d(),t=!1,l()}}}function bl(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-eye-slash")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function Il(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-eye")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function Ze(n){let e,t;return e=new Ke({props:{children:n[0].children,level:n[1]+1,move_idx:-n[0].id}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},p(l,a){const s={};a&1&&(s.children=l[0].children),a&2&&(s.level=l[1]+1),a&1&&(s.move_idx=-l[0].id),e.$set(s)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function _l(n){let e,t,l,a,s,r,i,c,o,f,$,m=n[0].value.name+"",d,g,h,v,V,R,N,G,z;l=new Pe({props:{level:n[1]}});let J=n[0].value.flag.type==="Group"&&Qe(n),C=(n[2]||!n[0].value.visible)&&We(n),S=n[0].value.flag.type==="Group"&&n[3]&&Ze(n);return R=new Oe({props:{move_idx:n[0].id,level:n[1]}}),{c(){e=w("li"),t=w("div"),A(l.$$.fragment),a=Y(),s=w("div"),r=w("div"),J&&J.c(),i=Y(),c=w("img"),o=Y(),f=w("div"),$=w("span"),d=oe(m),g=Y(),h=w("div"),C&&C.c(),v=Y(),S&&S.c(),V=Y(),A(R.$$.fragment),this.h()},l(X){e=y(X,"LI",{class:!0});var Q=b(e);t=y(Q,"DIV",{class:!0,draggable:!0});var D=b(t);P(l.$$.fragment,D),a=L(D),s=y(D,"DIV",{class:!0});var k=b(s);r=y(k,"DIV",{class:!0});var q=b(r);J&&J.l(q),q.forEach(u),i=L(k),c=y(k,"IMG",{class:!0,alt:!0}),o=L(k),f=y(k,"DIV",{class:!0});var W=b(f);$=y(W,"SPAN",{class:!0,spellcheck:!0,contenteditable:!0});var K=b($);d=fe(K,m),K.forEach(u),g=L(W),h=y(W,"DIV",{});var M=b(h);C&&C.l(M),M.forEach(u),W.forEach(u),k.forEach(u),D.forEach(u),v=L(Q),S&&S.l(Q),V=L(Q),P(R.$$.fragment,Q),Q.forEach(u),this.h()},h(){p(r,"class","left-of-preview svelte-ve4xfc"),p(c,"class","preview svelte-ve4xfc"),p(c,"alt","preview of layer"),p($,"class","layer-name"),p($,"spellcheck","false"),p($,"contenteditable",n[5]),p(f,"class","right-of-preview svelte-ve4xfc"),p(s,"class","layer-info svelte-ve4xfc"),p(t,"class","layer-box svelte-ve4xfc"),p(t,"draggable","true"),p(e,"class","layers svelte-ve4xfc"),se(e,"background",n[5]?"var(--color-lighter)":"var(--color-lightest)")},m(X,Q){_(X,e,Q),I(e,t),U(l,t,null),I(t,a),I(t,s),I(s,r),J&&J.m(r,null),I(s,i),I(s,c),n[15](c),I(s,o),I(s,f),I(f,$),I($,d),I(f,g),I(f,h),C&&C.m(h,null),I(e,v),S&&S.m(e,null),I(e,V),U(R,e,null),N=!0,G||(z=[O(r,"click",n[8]),O(r,"keydown",n[14]),O($,"input",n[10]),O(t,"click",n[6]),O(t,"keydown",n[13]),O(t,"mouseenter",n[9](!0)),O(t,"mouseleave",n[9](!1)),O(t,"dragstart",n[11](!0)),O(t,"dragend",n[11](!1))],G=!0)},p(X,[Q]){const D={};Q&2&&(D.level=X[1]),l.$set(D),X[0].value.flag.type==="Group"?J?J.p(X,Q):(J=Qe(X),J.c(),J.m(r,null)):J&&(J.d(1),J=null),(!N||Q&1)&&m!==(m=X[0].value.name+"")&&Sn(d,m,X[5]),(!N||Q&32)&&p($,"contenteditable",X[5]),X[2]||!X[0].value.visible?C?C.p(X,Q):(C=We(X),C.c(),C.m(h,null)):C&&(C.d(1),C=null),X[0].value.flag.type==="Group"&&X[3]?S?(S.p(X,Q),Q&9&&x(S,1)):(S=Ze(X),S.c(),x(S,1),S.m(e,V)):S&&(ie(),E(S,1,1,()=>{S=null}),ce());const k={};Q&1&&(k.move_idx=X[0].id),Q&2&&(k.level=X[1]),R.$set(k),Q&32&&se(e,"background",X[5]?"var(--color-lighter)":"var(--color-lightest)")},i(X){N||(x(l.$$.fragment,X),x(S),x(R.$$.fragment,X),N=!0)},o(X){E(l.$$.fragment,X),E(S),E(R.$$.fragment,X),N=!1},d(X){X&&u(e),T(l),J&&J.d(),n[15](null),C&&C.d(),S&&S.d(),T(R),G=!1,de(z)}}}function kl(n,e,t){let l;F(n,ge,C=>t(12,l=C));let{node:a}=e,{level:s}=e,r=!1,i=!0,c,[o,f]=a.value.size,$=H.get_content_of(a.value.pointer,o,f),m=new ImageData($,o,f);Ie(async()=>{if(!c||!m)return;let C=document.createElement("canvas");C.width=o,C.height=f,C.getContext("2d").putImageData(m,0,0),t(4,c.src=C.toDataURL("image/png"),c)});function d(C){let S=C.shiftKey,X=l.includes(a.id);S?X?ge.update(Q=>Q.filter(D=>D!==a.id)):ge.update(Q=>Q.concat([a.id])):ge.set([a.id])}function g(){H.perform_step({type:"layer/attr",id:a.id,visible:!a.value.visible})}function h(){t(3,i=!i)}function v(C){return()=>{t(2,r=C)}}function V(C){if(C.inputType==="insertParagraph"||C.inputType==="insertText"&&!C.data){C.stopPropagation();let S=C.target.innerText;S=S.replace(`
`,""),S=S.replace("\r",""),C.target.innerText=S,S!=a.value.name&&H.perform_step({type:"layer/attr",id:a.id,name:S});return}}function R(C){return()=>{C?Ce.set(a.id):Ce.set(null)}}let N=!1;function G(C){we.call(this,n,C)}function z(C){we.call(this,n,C)}function J(C){ne[C?"unshift":"push"](()=>{c=C,t(4,c)})}return n.$$set=C=>{"node"in C&&t(0,a=C.node),"level"in C&&t(1,s=C.level)},n.$$.update=()=>{n.$$.dirty&4097&&t(5,N=l.includes(a.id))},[a,s,r,i,c,N,d,g,h,v,V,R,l,G,z,J]}class Vl extends ee{constructor(e){super(),te(this,e,kl,_l,j,{node:0,level:1})}}function He(n,e,t){const l=n.slice();l[4]=e[t],l[8]=t;const a=l[0][l[0].length-1-l[8]];l[5]=a;const s=l[3].nodes[l[5]];return l[6]=s,l}function je(n){let e,t;return e=new Vl({props:{node:n[6],level:n[2]}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},p(l,a){const s={};a&9&&(s.node=l[6]),a&4&&(s.level=l[2]),e.$set(s)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function Dl(n){let e,t,l,a,s,r,i;t=new Pe({props:{level:n[2]}}),a=new Oe({props:{move_idx:n[1],level:n[2]}});let c={length:n[0].length},o=[];for(let $=0;$<c.length;$+=1)o[$]=je(He(n,c,$));const f=$=>E(o[$],1,1,()=>{o[$]=null});return{c(){e=w("div"),A(t.$$.fragment),l=Y(),A(a.$$.fragment),s=Y(),r=w("ul");for(let $=0;$<o.length;$+=1)o[$].c();this.h()},l($){e=y($,"DIV",{});var m=b(e);P(t.$$.fragment,m),l=L(m),P(a.$$.fragment,m),s=L(m),r=y(m,"UL",{class:!0});var d=b(r);for(let g=0;g<o.length;g+=1)o[g].l(d);d.forEach(u),m.forEach(u),this.h()},h(){p(r,"class","layers svelte-m4bv1g")},m($,m){_($,e,m),U(t,e,null),I(e,l),U(a,e,null),I(e,s),I(e,r);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(r,null);i=!0},p($,[m]){const d={};m&4&&(d.level=$[2]),t.$set(d);const g={};if(m&2&&(g.move_idx=$[1]),m&4&&(g.level=$[2]),a.$set(g),m&13){c={length:$[0].length};let h;for(h=0;h<c.length;h+=1){const v=He($,c,h);o[h]?(o[h].p(v,m),x(o[h],1)):(o[h]=je(v),o[h].c(),x(o[h],1),o[h].m(r,null))}for(ie(),h=c.length;h<o.length;h+=1)f(h);ce()}},i($){if(!i){x(t.$$.fragment,$),x(a.$$.fragment,$);for(let m=0;m<c.length;m+=1)x(o[m]);i=!0}},o($){E(t.$$.fragment,$),E(a.$$.fragment,$),o=o.filter(Boolean);for(let m=0;m<o.length;m+=1)E(o[m]);i=!1},d($){$&&u(e),T(t),T(a),_e(o,$)}}}function zl(n,e,t){let l;F(n,Ue,i=>t(3,l=i));let{children:a}=e,{move_idx:s=0}=e,{level:r=0}=e;return n.$$set=i=>{"children"in i&&t(0,a=i.children),"move_idx"in i&&t(1,s=i.move_idx),"level"in i&&t(2,r=i.level)},[a,s,r,l]}class Ke extends ee{constructor(e){super(),te(this,e,zl,Dl,j,{children:0,move_idx:1,level:2})}}function Nl(n){let e;return{c(){e=w("hr"),this.h()},l(t){e=y(t,"HR",{class:!0}),this.h()},h(){p(e,"class","svelte-1ahopmk")},m(t,l){_(t,e,l)},p:B,i:B,o:B,d(t){t&&u(e)}}}class De extends ee{constructor(e){super(),te(this,e,null,Nl,j,{})}}function Cl(n){let e;return{c(){e=w("div")},l(t){e=y(t,"DIV",{}),b(e).forEach(u)},m(t,l){_(t,e,l)},p:B,i:B,o:B,d(t){t&&u(e)}}}function Al(n){let e,t,l,a,s,r,i,c,o,f;function $(h){n[6](h)}let m={min:0,max:1,step:.01,name:"alpha",fmt:Rl};n[1]!==void 0&&(m.value=n[1]),l=new be({props:m}),ne.push(()=>me(l,"value",$));function d(h){n[7](h)}let g={title:"mode",options:[{key:null,value:he.Alpha},{key:null,value:he.Remove},{key:null,value:he.Lighten},{key:null,value:he.Darken},{key:null,value:he.Screen}]};return n[2]!==void 0&&(g.value=n[2]),r=new Ae({props:g}),ne.push(()=>me(r,"value",d)),o=new De({}),{c(){e=w("div"),t=w("div"),A(l.$$.fragment),s=Y(),A(r.$$.fragment),c=Y(),A(o.$$.fragment),this.h()},l(h){e=y(h,"DIV",{});var v=b(e);t=y(v,"DIV",{id:!0,class:!0});var V=b(t);P(l.$$.fragment,V),s=L(V),P(r.$$.fragment,V),V.forEach(u),c=L(v),P(o.$$.fragment,v),v.forEach(u),this.h()},h(){p(t,"id","layers-attributes"),p(t,"class","svelte-4zwbd8")},m(h,v){_(h,e,v),I(e,t),U(l,t,null),I(t,s),U(r,t,null),I(e,c),U(o,e,null),f=!0},p(h,v){const V={};!a&&v&2&&(a=!0,V.value=h[1],pe(()=>a=!1)),l.$set(V);const R={};!i&&v&4&&(i=!0,R.value=h[2],pe(()=>i=!1)),r.$set(R)},i(h){f||(x(l.$$.fragment,h),x(r.$$.fragment,h),x(o.$$.fragment,h),f=!0)},o(h){E(l.$$.fragment,h),E(r.$$.fragment,h),E(o.$$.fragment,h),f=!1},d(h){h&&u(e),T(l),T(r),T(o)}}}function Pl(n){let e,t,l,a;return l=new Ke({props:{children:n[3].nodes[n[3].root].children}}),{c(){e=w("div"),t=w("div"),A(l.$$.fragment),this.h()},l(s){e=y(s,"DIV",{id:!0,class:!0});var r=b(e);t=y(r,"DIV",{id:!0,class:!0});var i=b(t);P(l.$$.fragment,i),i.forEach(u),r.forEach(u),this.h()},h(){p(t,"id","layers-list"),p(t,"class","svelte-4zwbd8"),p(e,"id","layer-list-box"),p(e,"class","svelte-4zwbd8")},m(s,r){_(s,e,r),I(e,t),U(l,t,null),a=!0},p(s,r){const i={};r&8&&(i.children=s[3].nodes[s[3].root].children),l.$set(i)},i(s){a||(x(l.$$.fragment,s),a=!0)},o(s){E(l.$$.fragment,s),a=!1},d(s){s&&u(e),T(l)}}}function Ul(n){let e,t;return e=new ye({}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},p:B,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function et(n){let e,t,l,a,s,r,i,c,o,f,$,m;const d=[Al,Cl],g=[];function h(N,G){return N[0]||N[4]?0:1}t=h(n),l=g[t]=d[t](n);const v=[Ul,Pl],V=[];function R(N,G){return N[4]?0:1}return s=R(n),r=V[s]=v[s](n),c=new De({}),$=new cl({}),{c(){e=w("div"),l.c(),a=Y(),r.c(),i=Y(),A(c.$$.fragment),o=Y(),f=w("div"),A($.$$.fragment),this.h()},l(N){e=y(N,"DIV",{id:!0,class:!0});var G=b(e);l.l(G),a=L(G),r.l(G),i=L(G),P(c.$$.fragment,G),o=L(G),f=y(G,"DIV",{});var z=b(f);P($.$$.fragment,z),z.forEach(u),G.forEach(u),this.h()},h(){p(e,"id","layers-box"),p(e,"class","svelte-4zwbd8")},m(N,G){_(N,e,G),g[t].m(e,null),I(e,a),V[s].m(e,null),I(e,i),U(c,e,null),I(e,o),I(e,f),U($,f,null),m=!0},p(N,G){let z=t;t=h(N),t===z?g[t].p(N,G):(ie(),E(g[z],1,1,()=>{g[z]=null}),ce(),l=g[t],l?l.p(N,G):(l=g[t]=d[t](N),l.c()),x(l,1),l.m(e,a));let J=s;s=R(N),s===J?V[s].p(N,G):(ie(),E(V[J],1,1,()=>{V[J]=null}),ce(),r=V[s],r?r.p(N,G):(r=V[s]=v[s](N),r.c()),x(r,1),r.m(e,i))},i(N){m||(x(l),x(r),x(c.$$.fragment,N),x($.$$.fragment,N),m=!0)},o(N){E(l),E(r),E(c.$$.fragment,N),E($.$$.fragment,N),m=!1},d(N){N&&u(e),g[t].d(),V[s].d(),T(c),T($)}}}function Tl(n){let e=n[3],t,l,a=et(n);return{c(){a.c(),t=ae()},l(s){a.l(s),t=ae()},m(s,r){a.m(s,r),_(s,t,r),l=!0},p(s,[r]){r&8&&j(e,e=s[3])?(ie(),E(a,1,1,B),ce(),a=et(s),a.c(),x(a,1),a.m(t.parentNode,t)):a.p(s,r)},i(s){l||(x(a),l=!0)},o(s){E(a),l=!1},d(s){s&&u(t),a.d(s)}}}const Rl=n=>`${~~(n*100)}%`;function Yl(n,e,t){let l,a,s;F(n,Ue,h=>t(3,l=h)),F(n,ge,h=>t(5,a=h)),F(n,xe,h=>t(4,s=h));let r=null,i=null,c=0,o=he.Alpha;function f(h){i=h?l.nodes[h]:null,t(1,c=i&&i.value.attr.alpha),t(2,o=i&&i.value.attr.mode)}function $(h){i&&c!=i.value.attr.alpha&&H.perform_step({type:"layer/attr",id:i.id,alpha:h})}function m(h){i&&h!=i.value.attr.mode&&H.perform_step({type:"layer/attr",id:i.id,mode:h})}function d(h){c=h,t(1,c)}function g(h){o=h,t(2,o)}return n.$$.update=()=>{n.$$.dirty&32&&t(0,r=a.length===1?a[0]:null),n.$$.dirty&1&&r&&f(r),n.$$.dirty&2&&$(c),n.$$.dirty&4&&m(o)},[r,c,o,l,s,a,d,g]}class Ll extends ee{constructor(e){super(),te(this,e,Yl,Tl,j,{})}}function Sl(n){let e,t,l;return t=new ye({}),{c(){e=w("div"),A(t.$$.fragment),this.h()},l(a){e=y(a,"DIV",{class:!0});var s=b(e);P(t.$$.fragment,s),s.forEach(u),this.h()},h(){p(e,"class","box svelte-1xn751k"),se(e,"width",`${n[0]}px`),se(e,"height",`${n[1]}px`)},m(a,s){_(a,e,s),U(t,e,null),l=!0},p(a,s){s&1&&se(e,"width",`${a[0]}px`),s&2&&se(e,"height",`${a[1]}px`)},i(a){l||(x(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&u(e),T(t)}}}function Gl(n){let e,t,l,a,s,r={height:n[1],width:n[0]};return t=new Le({props:r}),n[9](t),{c(){e=w("div"),A(t.$$.fragment),l=Y(),a=w("canvas"),this.h()},l(i){e=y(i,"DIV",{class:!0});var c=b(e);P(t.$$.fragment,c),l=L(c),a=y(c,"CANVAS",{id:!0,height:!0,width:!0,class:!0}),b(a).forEach(u),c.forEach(u),this.h()},h(){p(a,"id","brush-preview"),p(a,"height",n[1]),p(a,"width",n[0]),p(a,"class","svelte-1xn751k"),p(e,"class","box svelte-1xn751k"),se(e,"width",`${n[0]}px`),se(e,"height",`${n[1]}px`)},m(i,c){_(i,e,c),U(t,e,null),I(e,l),I(e,a),n[10](a),s=!0},p(i,c){const o={};c&2&&(o.height=i[1]),c&1&&(o.width=i[0]),t.$set(o),(!s||c&2)&&p(a,"height",i[1]),(!s||c&1)&&p(a,"width",i[0]),c&1&&se(e,"width",`${i[0]}px`),c&2&&se(e,"height",`${i[1]}px`)},i(i){s||(x(t.$$.fragment,i),s=!0)},o(i){E(t.$$.fragment,i),s=!1},d(i){i&&u(e),n[9](null),T(t),n[10](null)}}}function Ml(n){let e,t,l,a;const s=[Gl,Sl],r=[];function i(c,o){return c[4]?1:0}return e=i(n),t=r[e]=s[e](n),{c(){t.c(),l=ae()},l(c){t.l(c),l=ae()},m(c,o){r[e].m(c,o),_(c,l,o),a=!0},p(c,[o]){let f=e;e=i(c),e===f?r[e].p(c,o):(ie(),E(r[f],1,1,()=>{r[f]=null}),ce(),t=r[e],t?t.p(c,o):(t=r[e]=s[e](c),t.c()),x(t,1),t.m(l.parentNode,l))},i(c){a||(x(t),a=!0)},o(c){E(t),a=!1},d(c){r[e].d(c),c&&u(l)}}}function Bl(n){let e=parseInt(n.substring(1),16),t=e>>16&255,l=e>>8&255,a=e&255;return[t,l,a]}function Jl(n,e,t){let l,a,s,r,i;F(n,ke,h=>t(5,l=h)),F(n,Ve,h=>t(6,a=h)),F(n,Te,h=>t(7,s=h)),F(n,Re,h=>t(8,r=h)),F(n,xe,h=>t(4,i=h));let{width:c}=e,{height:o}=e,f,$;function m(h,v,V,R,N){if(!h)return;let G=h.getContext("2d"),z=Math.min(o,c)/2,J=z*V;const C=G.createImageData(c,o);let S=C.data,[X,Q,D]=Bl(R);for(let k=0;k<o;k++)for(let q=0;q<c;q++){let W=4*(k*c+q);S[W]=X,S[W+1]=Q,S[W+2]=D,S[W+3]=0;let K=Math.sqrt((q-c/2)**2+(k-o/2)**2);if(N)if(S[W+3]=255-v,K<=z&&K>J){let M=(K-J)/(z-J);S[W+3]=Math.min(~~(255*M)+S[W+3],255)}else K>z&&(S[W+3]=255);else if(K<=J)S[W+3]=v;else if(K<=z){let M=1-(K-J)/(z-J);S[W+3]=~~(v*M)}}G.putImageData(C,0,0)}function d(h){ne[h?"unshift":"push"](()=>{$=h,t(3,$)})}function g(h){ne[h?"unshift":"push"](()=>{f=h,t(2,f)})}return n.$$set=h=>{"width"in h&&t(0,c=h.width),"height"in h&&t(1,o=h.height)},n.$$.update=()=>{n.$$.dirty&484&&m(f,r,s,a,l===ue.Eraser)},[c,o,f,$,i,l,a,s,r,d,g]}class Xl extends ee{constructor(e){super(),te(this,e,Jl,Ml,j,{width:0,height:1})}}function tt(n,e,t){const l=n.slice();return l[18]=e[t].value,l[19]=e[t].label,l}function ql(n){let e,t,l,a;e=new Ee({props:{$$slots:{default:[Wl]},$$scope:{ctx:n}}});let s=n[8],r=[];for(let i=0;i<s.length;i+=1)r[i]=lt(tt(n,s,i));return{c(){A(e.$$.fragment),t=Y(),l=w("ul");for(let i=0;i<r.length;i+=1)r[i].c()},l(i){P(e.$$.fragment,i),t=L(i),l=y(i,"UL",{});var c=b(l);for(let o=0;o<r.length;o+=1)r[o].l(c);c.forEach(u)},m(i,c){U(e,i,c),_(i,t,c),_(i,l,c);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(l,null);a=!0},p(i,c){const o={};if(c&4194305&&(o.$$scope={dirty:c,ctx:i}),e.$set(o),c&384){s=i[8];let f;for(f=0;f<s.length;f+=1){const $=tt(i,s,f);r[f]?r[f].p($,c):(r[f]=lt($),r[f].c(),r[f].m(l,null))}for(;f<r.length;f+=1)r[f].d(1);r.length=s.length}},i(i){a||(x(e.$$.fragment,i),a=!0)},o(i){E(e.$$.fragment,i),a=!1},d(i){T(e,i),i&&u(t),i&&u(l),_e(r,i)}}}function Fl(n){let e,t,l,a,s,r,i,c,o,f,$,m,d,g,h,v,V,R;t=new Xl({props:{width:60,height:60}});function N(k){n[11](k)}let G={min:0,max:255,name:"alpha",fmt:Hl};n[2]!==void 0&&(G.value=n[2]),s=new be({props:G}),ne.push(()=>me(s,"value",N));function z(k){n[12](k)}let J={min:0,max:1,step:.01,name:"hardness",fmt:jl};n[3]!==void 0&&(J.value=n[3]),c=new be({props:J}),ne.push(()=>me(c,"value",z));function C(k){n[13](k)}let S={min:0,max:100,name:"radius",fmt:Kl};n[4]!==void 0&&(S.value=n[4]),$=new be({props:S}),ne.push(()=>me($,"value",C));function X(k){n[14](k)}let Q={min:1,max:100,step:1,name:"distance",fmt:en};n[5]!==void 0&&(Q.value=n[5]),g=new be({props:Q}),ne.push(()=>me(g,"value",X));let D=n[1]===ue.Brush&&nt(n);return{c(){e=w("div"),A(t.$$.fragment),l=Y(),a=w("div"),A(s.$$.fragment),i=Y(),A(c.$$.fragment),f=Y(),A($.$$.fragment),d=Y(),A(g.$$.fragment),v=Y(),D&&D.c(),V=ae(),this.h()},l(k){e=y(k,"DIV",{class:!0});var q=b(e);P(t.$$.fragment,q),l=L(q),a=y(q,"DIV",{class:!0});var W=b(a);P(s.$$.fragment,W),i=L(W),P(c.$$.fragment,W),W.forEach(u),q.forEach(u),f=L(k),P($.$$.fragment,k),d=L(k),P(g.$$.fragment,k),v=L(k),D&&D.l(k),V=ae(),this.h()},h(){p(a,"class","whatever svelte-m5l18c"),p(e,"class","compact svelte-m5l18c")},m(k,q){_(k,e,q),U(t,e,null),I(e,l),I(e,a),U(s,a,null),I(a,i),U(c,a,null),_(k,f,q),U($,k,q),_(k,d,q),U(g,k,q),_(k,v,q),D&&D.m(k,q),_(k,V,q),R=!0},p(k,q){const W={};!r&&q&4&&(r=!0,W.value=k[2],pe(()=>r=!1)),s.$set(W);const K={};!o&&q&8&&(o=!0,K.value=k[3],pe(()=>o=!1)),c.$set(K);const M={};!m&&q&16&&(m=!0,M.value=k[4],pe(()=>m=!1)),$.$set(M);const Z={};!h&&q&32&&(h=!0,Z.value=k[5],pe(()=>h=!1)),g.$set(Z),k[1]===ue.Brush?D?(D.p(k,q),q&2&&x(D,1)):(D=nt(k),D.c(),x(D,1),D.m(V.parentNode,V)):D&&(ie(),E(D,1,1,()=>{D=null}),ce())},i(k){R||(x(t.$$.fragment,k),x(s.$$.fragment,k),x(c.$$.fragment,k),x($.$$.fragment,k),x(g.$$.fragment,k),x(D),R=!0)},o(k){E(t.$$.fragment,k),E(s.$$.fragment,k),E(c.$$.fragment,k),E($.$$.fragment,k),E(g.$$.fragment,k),E(D),R=!1},d(k){k&&u(e),T(t),T(s),T(c),k&&u(f),T($,k),k&&u(d),T(g,k),k&&u(v),D&&D.d(k),k&&u(V)}}}function Ol(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa-solid fa-up-down")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function Ql(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa-solid fa-left-right")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function Wl(n){let e,t,l,a;return e=new re({props:{disabled:!n[0],title:"flip vertically",$$slots:{default:[Ol]},$$scope:{ctx:n}}}),e.$on("click",n[9]("vertically")),l=new re({props:{disabled:!n[0],title:"flip horizontally",$$slots:{default:[Ql]},$$scope:{ctx:n}}}),l.$on("click",n[9]("horizontally")),{c(){A(e.$$.fragment),t=Y(),A(l.$$.fragment)},l(s){P(e.$$.fragment,s),t=L(s),P(l.$$.fragment,s)},m(s,r){U(e,s,r),_(s,t,r),U(l,s,r),a=!0},p(s,r){const i={};r&1&&(i.disabled=!s[0]),r&4194304&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const c={};r&1&&(c.disabled=!s[0]),r&4194304&&(c.$$scope={dirty:r,ctx:s}),l.$set(c)},i(s){a||(x(e.$$.fragment,s),x(l.$$.fragment,s),a=!0)},o(s){E(e.$$.fragment,s),E(l.$$.fragment,s),a=!1},d(s){T(e,s),s&&u(t),T(l,s)}}}function lt(n){let e,t,l=n[19]+"",a,s,r,i,c;return r=Gn(n[17][0]),{c(){e=w("li"),t=w("input"),a=oe(l),s=Y(),this.h()},l(o){e=y(o,"LI",{});var f=b(e);t=y(f,"INPUT",{type:!0}),a=fe(f,l),s=L(f),f.forEach(u),this.h()},h(){p(t,"type","radio"),t.__value=n[18],t.value=t.__value,r.p(t)},m(o,f){_(o,e,f),I(e,t),t.checked=t.__value===n[7],I(e,a),I(e,s),i||(c=O(t,"change",n[16]),i=!0)},p(o,f){f&128&&(t.checked=t.__value===o[7])},d(o){o&&u(e),r.r(),i=!1,c()}}}function nt(n){let e,t,l;function a(r){n[15](r)}let s={title:"mode",options:[{key:null,value:he.Alpha},{key:null,value:he.Darken},{key:null,value:he.Lighten},{key:null,value:he.Screen}]};return n[6]!==void 0&&(s.value=n[6]),e=new Ae({props:s}),ne.push(()=>me(e,"value",a)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){U(e,r,i),l=!0},p(r,i){const c={};!t&&i&64&&(t=!0,c.value=r[6],pe(()=>t=!1)),e.$set(c)},i(r){l||(x(e.$$.fragment,r),l=!0)},o(r){E(e.$$.fragment,r),l=!1},d(r){T(e,r)}}}function Zl(n){let e,t,l,a;const s=[Fl,ql],r=[];function i(c,o){return c[1]===ue.Brush||c[1]===ue.Eraser?0:c[1]===ue.Move?1:-1}return~(t=i(n))&&(l=r[t]=s[t](n)),{c(){e=w("div"),l&&l.c(),this.h()},l(c){e=y(c,"DIV",{class:!0});var o=b(e);l&&l.l(o),o.forEach(u),this.h()},h(){p(e,"class","box svelte-m5l18c")},m(c,o){_(c,e,o),~t&&r[t].m(e,null),a=!0},p(c,[o]){let f=t;t=i(c),t===f?~t&&r[t].p(c,o):(l&&(ie(),E(r[f],1,1,()=>{r[f]=null}),ce()),~t?(l=r[t],l?l.p(c,o):(l=r[t]=s[t](c),l.c()),x(l,1),l.m(e,null)):l=null)},i(c){a||(x(l),a=!0)},o(c){E(l),a=!1},d(c){c&&u(e),~t&&r[t].d()}}}const Hl=n=>`${~~(n/255*100)}%`,jl=n=>`${~~(n*100)}%`,Kl=n=>`${n}px`,en=n=>`${n}`;function tn(n,e,t){let l,a,s,r,i,c,o,f;F(n,ge,z=>t(10,l=z)),F(n,ke,z=>t(1,a=z)),F(n,Re,z=>t(2,s=z)),F(n,Te,z=>t(3,r=z)),F(n,yt,z=>t(4,i=z)),F(n,xt,z=>t(5,c=z)),F(n,Et,z=>t(6,o=z)),F(n,bt,z=>t(7,f=z));const $=[{value:It.Selected,label:"Move selected layer"},{value:It.Clicked,label:"Move layer that is clicked"}];function m(z){return()=>{l.length!=0&&H.perform_step({type:"layer/flip",id:l[0],direction:z})}}let d=l.length==1;const g=[[]];function h(z){s=z,Re.set(s)}function v(z){r=z,Te.set(r)}function V(z){i=z,yt.set(i)}function R(z){c=z,xt.set(c)}function N(z){o=z,Et.set(o)}function G(){f=this.__value,bt.set(f)}return n.$$.update=()=>{n.$$.dirty&1024&&t(0,d=l.length==1)},[d,a,s,r,i,c,o,f,$,m,l,h,v,V,R,N,G,g]}class ln extends ee{constructor(e){super(),te(this,e,tn,Zl,j,{})}}function nn(n){let e,t,l,a,s,r;return t=new ye({}),s=new ye({}),{c(){e=w("div"),A(t.$$.fragment),l=Y(),a=w("div"),A(s.$$.fragment),this.h()},l(i){e=y(i,"DIV",{class:!0});var c=b(e);P(t.$$.fragment,c),c.forEach(u),l=L(i),a=y(i,"DIV",{class:!0});var o=b(a);P(s.$$.fragment,o),o.forEach(u),this.h()},h(){p(e,"class","color-box color2 svelte-i90gv5"),p(a,"class","color-box color1 svelte-i90gv5")},m(i,c){_(i,e,c),U(t,e,null),_(i,l,c),_(i,a,c),U(s,a,null),r=!0},p:B,i(i){r||(x(t.$$.fragment,i),x(s.$$.fragment,i),r=!0)},o(i){E(t.$$.fragment,i),E(s.$$.fragment,i),r=!1},d(i){i&&u(e),T(t),i&&u(l),i&&u(a),T(s)}}}function sn(n){let e,t,l,a,s,r,i,c;return{c(){e=w("div"),t=Y(),l=w("label"),a=w("div"),s=Y(),r=w("input"),this.h()},l(o){e=y(o,"DIV",{class:!0,style:!0}),b(e).forEach(u),t=L(o),l=y(o,"LABEL",{});var f=b(l);a=y(f,"DIV",{class:!0,style:!0}),b(a).forEach(u),s=L(f),r=y(f,"INPUT",{type:!0}),f.forEach(u),this.h()},h(){p(e,"class","color-box color2 svelte-i90gv5"),se(e,"background-color",n[0]),p(a,"class","color-box color1 svelte-i90gv5"),se(a,"background-color",n[1]),p(r,"type","color"),r.hidden=!0},m(o,f){_(o,e,f),_(o,t,f),_(o,l,f),I(l,a),I(l,s),I(l,r),ze(r,n[1]),i||(c=[O(e,"click",n[3]),O(e,"keydown",n[6]),O(r,"input",n[7])],i=!0)},p(o,f){f&1&&se(e,"background-color",o[0]),f&2&&se(a,"background-color",o[1]),f&2&&ze(r,o[1])},i:B,o:B,d(o){o&&u(e),o&&u(t),o&&u(l),i=!1,de(c)}}}function st(n){let e,t,l,a,s,r;return{c(){e=w("div"),t=w("div"),l=Y(),a=w("div"),this.h()},l(i){e=y(i,"DIV",{});var c=b(e);t=y(c,"DIV",{class:!0}),b(t).forEach(u),l=L(c),a=y(c,"DIV",{class:!0}),b(a).forEach(u),c.forEach(u),this.h()},h(){p(t,"class","default-box default-black svelte-i90gv5"),p(a,"class","default-box default-white svelte-i90gv5")},m(i,c){_(i,e,c),I(e,t),I(e,l),I(e,a),s||(r=[O(e,"click",n[4]),O(e,"keydown",n[5])],s=!0)},p:B,d(i){i&&u(e),s=!1,de(r)}}}function an(n){let e,t,l,a,s;const r=[sn,nn],i=[];function c(f,$){return f[2]?1:0}t=c(n),l=i[t]=r[t](n);let o=!n[2]&&st(n);return{c(){e=w("div"),l.c(),a=Y(),o&&o.c(),this.h()},l(f){e=y(f,"DIV",{class:!0});var $=b(e);l.l($),a=L($),o&&o.l($),$.forEach(u),this.h()},h(){p(e,"class","color-picker svelte-i90gv5")},m(f,$){_(f,e,$),i[t].m(e,null),I(e,a),o&&o.m(e,null),s=!0},p(f,[$]){let m=t;t=c(f),t===m?i[t].p(f,$):(ie(),E(i[m],1,1,()=>{i[m]=null}),ce(),l=i[t],l?l.p(f,$):(l=i[t]=r[t](f),l.c()),x(l,1),l.m(e,a)),f[2]?o&&(o.d(1),o=null):o?o.p(f,$):(o=st(f),o.c(),o.m(e,null))},i(f){s||(x(l),s=!0)},o(f){E(l),s=!1},d(f){f&&u(e),i[t].d(),o&&o.d()}}}function rn(n,e,t){let l,a,s;F(n,Ye,$=>t(0,l=$)),F(n,Ve,$=>t(1,a=$)),F(n,xe,$=>t(2,s=$));function r(){let $=a;Ve.set(l),Ye.set($)}function i(){Ve.set("#ffffff"),Ye.set("#000000")}function c($){we.call(this,n,$)}function o($){we.call(this,n,$)}function f(){a=this.value,Ve.set(a)}return[l,a,s,r,i,c,o,f]}class cn extends ee{constructor(e){super(),te(this,e,rn,an,j,{})}}function on(n){let e,t,l,a,s;return t=new cn({}),a=new Xn({props:{value:n[0],options:n[1],onChange:n[2]}}),{c(){e=w("div"),A(t.$$.fragment),l=Y(),A(a.$$.fragment),this.h()},l(r){e=y(r,"DIV",{id:!0,class:!0});var i=b(e);P(t.$$.fragment,i),l=L(i),P(a.$$.fragment,i),i.forEach(u),this.h()},h(){p(e,"id","tools"),p(e,"class","svelte-u6k2ef")},m(r,i){_(r,e,i),U(t,e,null),I(e,l),U(a,e,null),s=!0},p(r,[i]){const c={};i&1&&(c.value=r[0]),a.$set(c)},i(r){s||(x(t.$$.fragment,r),x(a.$$.fragment,r),s=!0)},o(r){E(t.$$.fragment,r),E(a.$$.fragment,r),s=!1},d(r){r&&u(e),T(t),T(a)}}}function fn(n,e,t){let l;F(n,ke,s=>t(0,l=s));let a=[{value:ue.Brush,icon:"fa-pencil",title:"brush",shortcut:{shift:!0,code:"Digit1"}},{value:ue.Eraser,icon:"fa-eraser",title:"eraser",shortcut:{shift:!0,code:"Digit2"}},{value:ue.Move,icon:"fa-arrows",title:"move",shortcut:{shift:!0,code:"Digit3"}}];return[l,a,s=>ke.set(s)]}class $n extends ee{constructor(e){super(),te(this,e,fn,on,j,{})}}function at(n){let e,t,l,a,s,r,i,c,o,f,$,m,d,g,h=n[2]&&rt();c=new re({props:{$$slots:{default:[un]},$$scope:{ctx:n}}}),c.$on("click",n[6]),f=new De({});const v=n[3].default,V=ht(v,n,n[8],null);return{c(){e=w("div"),t=w("div"),l=w("header"),a=w("span"),h&&h.c(),s=Y(),r=oe(n[1]),i=Y(),A(c.$$.fragment),o=Y(),A(f.$$.fragment),$=Y(),V&&V.c(),this.h()},l(R){e=y(R,"DIV",{class:!0});var N=b(e);t=y(N,"DIV",{class:!0});var G=b(t);l=y(G,"HEADER",{class:!0});var z=b(l);a=y(z,"SPAN",{});var J=b(a);h&&h.l(J),s=L(J),r=fe(J,n[1]),J.forEach(u),i=L(z),P(c.$$.fragment,z),z.forEach(u),o=L(G),P(f.$$.fragment,G),$=L(G),V&&V.l(G),G.forEach(u),N.forEach(u),this.h()},h(){p(l,"class","popup-header svelte-1d20gdm"),p(t,"class","popup svelte-1d20gdm"),p(e,"class","overlay svelte-1d20gdm")},m(R,N){_(R,e,N),I(e,t),I(t,l),I(l,a),h&&h.m(a,null),I(a,s),I(a,r),I(l,i),U(c,l,null),I(t,o),U(f,t,null),I(t,$),V&&V.m(t,null),m=!0,d||(g=[O(t,"click",dn),O(t,"keydown",n[5]),O(e,"click",n[7]),O(e,"keydown",n[4])],d=!0)},p(R,N){R[2]?h||(h=rt(),h.c(),h.m(a,s)):h&&(h.d(1),h=null),(!m||N&2)&&ve(r,R[1]);const G={};N&256&&(G.$$scope={dirty:N,ctx:R}),c.$set(G),V&&V.p&&(!m||N&256)&&dt(V,v,R,R[8],m?pt(v,R[8],N,null):mt(R[8]),null)},i(R){m||(x(c.$$.fragment,R),x(f.$$.fragment,R),x(V,R),m=!0)},o(R){E(c.$$.fragment,R),E(f.$$.fragment,R),E(V,R),m=!1},d(R){R&&u(e),h&&h.d(),T(c),T(f),V&&V.d(R),d=!1,de(g)}}}function rt(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-exclamation-triangle")},m(t,l){_(t,e,l)},d(t){t&&u(e)}}}function un(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-times")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function hn(n){let e,t,l=n[0]&&at(n);return{c(){l&&l.c(),e=ae()},l(a){l&&l.l(a),e=ae()},m(a,s){l&&l.m(a,s),_(a,e,s),t=!0},p(a,[s]){a[0]?l?(l.p(a,s),s&1&&x(l,1)):(l=at(a),l.c(),x(l,1),l.m(e.parentNode,e)):l&&(ie(),E(l,1,1,()=>{l=null}),ce())},i(a){t||(x(l),t=!0)},o(a){E(l),t=!1},d(a){l&&l.d(a),a&&u(e)}}}const dn=n=>n.stopImmediatePropagation();function mn(n,e,t){let{$$slots:l={},$$scope:a}=e,{show:s=!1}=e,{title:r=""}=e,{isError:i=!0}=e;function c(m){we.call(this,n,m)}function o(m){we.call(this,n,m)}const f=()=>t(0,s=!1),$=()=>t(0,s=!1);return n.$$set=m=>{"show"in m&&t(0,s=m.show),"title"in m&&t(1,r=m.title),"isError"in m&&t(2,i=m.isError),"$$scope"in m&&t(8,a=m.$$scope)},[s,r,i,l,c,o,f,$,a]}class pn extends ee{constructor(e){super(),te(this,e,mn,hn,j,{show:0,title:1,isError:2})}}function gn(n){let e,t;return e=new Ot({}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function vn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-home")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function wn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-download")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function yn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-arrow-left")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function xn(n){let e;return{c(){e=w("i"),this.h()},l(t){e=y(t,"I",{class:!0}),b(e).forEach(u),this.h()},h(){p(e,"class","fa fa-arrow-right")},m(t,l){_(t,e,l)},p:B,d(t){t&&u(e)}}}function En(n){let e,t,l,a;return e=new re({props:{disabled:!n[3],title:"undo",$$slots:{default:[yn]},$$scope:{ctx:n}}}),e.$on("click",H.undo),l=new re({props:{disabled:!n[4],title:"redo",$$slots:{default:[xn]},$$scope:{ctx:n}}}),l.$on("click",H.redo),{c(){A(e.$$.fragment),t=Y(),A(l.$$.fragment)},l(s){P(e.$$.fragment,s),t=L(s),P(l.$$.fragment,s)},m(s,r){U(e,s,r),_(s,t,r),U(l,s,r),a=!0},p(s,r){const i={};r&8&&(i.disabled=!s[3]),r&2048&&(i.$$scope={dirty:r,ctx:s}),e.$set(i);const c={};r&16&&(c.disabled=!s[4]),r&2048&&(c.$$scope={dirty:r,ctx:s}),l.$set(c)},i(s){a||(x(e.$$.fragment,s),x(l.$$.fragment,s),a=!0)},o(s){E(e.$$.fragment,s),E(l.$$.fragment,s),a=!1},d(s){T(e,s),s&&u(t),T(l,s)}}}function bn(n){let e,t;return e=new ln({}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function In(n){let e,t;return e=new Ll({}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function _n(n){let e,t,l,a,s,r,i,c,o,f,$,m,d,g,h,v,V,R,N,G,z,J,C,S,X,Q,D,k,q;function W(M){n[6](M)}let K={$$slots:{default:[gn]},$$scope:{ctx:n}};return n[1]!==void 0&&(K.show=n[1]),t=new pn({props:K}),ne.push(()=>me(t,"show",W)),o=new re({props:{title:"home",$$slots:{default:[vn]},$$scope:{ctx:n}}}),o.$on("click",function(){Mn(n[0])&&n[0].apply(this,arguments)}),$=new Ae({props:{value:n[2],title:"blender",options:[{key:"Software",value:"Software"},{key:"WebGL",value:"WebGL"}]}}),$.$on("change",n[7]),d=new re({props:{title:"download",$$slots:{default:[wn]},$$scope:{ctx:n}}}),d.$on("click",n[5]),h=new Ee({props:{$$slots:{default:[En]},$$scope:{ctx:n}}}),V=new De({}),N=new $n({}),z=new _t({props:{$$slots:{default:[bn]},$$scope:{ctx:n}}}),C=new _t({props:{$$slots:{default:[In]},$$scope:{ctx:n}}}),D=new Bt({}),{c(){e=w("div"),A(t.$$.fragment),a=Y(),s=w("div"),r=w("div"),i=Y(),c=w("div"),A(o.$$.fragment),f=Y(),A($.$$.fragment),m=Y(),A(d.$$.fragment),g=Y(),A(h.$$.fragment),v=Y(),A(V.$$.fragment),R=Y(),A(N.$$.fragment),G=Y(),A(z.$$.fragment),J=Y(),A(C.$$.fragment),S=Y(),X=w("div"),Q=Y(),A(D.$$.fragment),k=oe(`
*/`),this.h()},l(M){e=y(M,"DIV",{class:!0});var Z=b(e);P(t.$$.fragment,Z),a=L(Z),s=y(Z,"DIV",{id:!0,class:!0});var le=b(s);r=y(le,"DIV",{}),b(r).forEach(u),i=L(le),c=y(le,"DIV",{class:!0});var $e=b(c);P(o.$$.fragment,$e),f=L($e),P($.$$.fragment,$e),m=L($e),P(d.$$.fragment,$e),g=L($e),P(h.$$.fragment,$e),$e.forEach(u),v=L(le),P(V.$$.fragment,le),R=L(le),P(N.$$.fragment,le),G=L(le),P(z.$$.fragment,le),J=L(le),P(C.$$.fragment,le),S=L(le),X=y(le,"DIV",{}),b(X).forEach(u),le.forEach(u),Q=L(Z),P(D.$$.fragment,Z),Z.forEach(u),k=fe(M,`
*/`),this.h()},h(){p(c,"class","top-tooling svelte-wng6sl"),p(s,"id","sidebar"),p(s,"class","svelte-wng6sl"),p(e,"class","layout svelte-wng6sl")},m(M,Z){_(M,e,Z),U(t,e,null),I(e,a),I(e,s),I(s,r),I(s,i),I(s,c),U(o,c,null),I(c,f),U($,c,null),I(c,m),U(d,c,null),I(c,g),U(h,c,null),I(s,v),U(V,s,null),I(s,R),U(N,s,null),I(s,G),U(z,s,null),I(s,J),U(C,s,null),I(s,S),I(s,X),I(e,Q),U(D,e,null),_(M,k,Z),q=!0},p(M,[Z]){n=M;const le={};Z&2048&&(le.$$scope={dirty:Z,ctx:n}),!l&&Z&2&&(l=!0,le.show=n[1],pe(()=>l=!1)),t.$set(le);const $e={};Z&2048&&($e.$$scope={dirty:Z,ctx:n}),o.$set($e);const it={};Z&4&&(it.value=n[2]),$.$set(it);const ct={};Z&2048&&(ct.$$scope={dirty:Z,ctx:n}),d.$set(ct);const ot={};Z&2072&&(ot.$$scope={dirty:Z,ctx:n}),h.$set(ot);const ft={};Z&2048&&(ft.$$scope={dirty:Z,ctx:n}),z.$set(ft);const $t={};Z&2048&&($t.$$scope={dirty:Z,ctx:n}),C.$set($t)},i(M){q||(x(t.$$.fragment,M),x(o.$$.fragment,M),x($.$$.fragment,M),x(d.$$.fragment,M),x(h.$$.fragment,M),x(V.$$.fragment,M),x(N.$$.fragment,M),x(z.$$.fragment,M),x(C.$$.fragment,M),x(D.$$.fragment,M),q=!0)},o(M){E(t.$$.fragment,M),E(o.$$.fragment,M),E($.$$.fragment,M),E(d.$$.fragment,M),E(h.$$.fragment,M),E(V.$$.fragment,M),E(N.$$.fragment,M),E(z.$$.fragment,M),E(C.$$.fragment,M),E(D.$$.fragment,M),q=!1},d(M){M&&u(e),T(t),T(o),T($),T(d),T(h),T(V),T(N),T(z),T(C),T(D),M&&u(k)}}}function kn(n){let e=window.atob(n),t=e.length,l=new Uint8Array(t);for(let a=0;a<t;a++){let s=e.charCodeAt(a);l[a]=s}return l}function Vn(n,e,t){let l=document.createElement("canvas");return l.width=e,l.height=t,l.getContext("2d").putImageData(n,0,0),l.toDataURL("image/png").slice(22)}function Dn(n,e){let t=document.createElement("a");document.body.appendChild(t),t.href=e,t.download=n,t.click(),t.remove()}function zn(n,e,t){let l,a,s,r,i;F(n,Ue,g=>t(8,l=g)),F(n,Ne,g=>t(9,a=g)),F(n,qn,g=>t(2,s=g)),F(n,Fn,g=>t(3,r=g)),F(n,On,g=>t(4,i=g));let{moveHome:c=()=>{}}=e;const o={types:[{description:"Image file (png)",accept:{"image/png":[".png"]}}],suggestedName:"result.png"};async function f(){let g=a.img_size.width,h=a.img_size.height,v=l.nodes[l.root].value.pointer,V=H.get_content_of(v,g,h),R=new ImageData(V,g,h),N=Vn(R,g,h),G=kn(N),z=new Blob([G],{type:"image/png"}),J=window.URL.createObjectURL(z),C=window.showSaveFilePicker;if(C)try{const S=await(await C(o)).createWritable();await S.write(z),S.close()}catch{}else Dn("result.png",J);window.URL.revokeObjectURL(J)}let $=!1;function m(g){$=g,t(1,$)}const d=g=>H.switch_blender(g.target.value);return n.$$set=g=>{"moveHome"in g&&t(0,c=g.moveHome)},[c,$,s,r,i,f,m,d]}class Nn extends ee{constructor(e){super(),te(this,e,zn,_n,j,{moveHome:0})}}function Cn(n){let e,t;return e=new Nn({props:{moveHome:n[0]}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},p:B,i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function An(n,e,t){let l,a;F(n,wt,o=>t(1,l=o)),F(n,vt,o=>t(2,a=o));const s=o=>new Promise(f=>setTimeout(f,o)),r=new URL(window.location.toString());function i(){let o={idx:a,history:l,preview:null},f="local/default";localStorage.getItem(f)&&confirm("Replace stored local project with the current one?")&&localStorage.setItem(f,JSON.stringify(o)),window.location=`${Zn}/`}window.onbeforeunload=function(){return"Are you sure?"};let c=async()=>{let o=parseInt(r.searchParams.get("w"))||2e3,f=parseInt(r.searchParams.get("h"))||1500,$=r.searchParams.get("local");if($){let m=JSON.parse(localStorage.getItem(`local/${$}`));m?await H.from_history(m.idx,m.history):await H.init(o,f)}else r.searchParams.delete("w"),r.searchParams.delete("h"),window.history.pushState(void 0,void 0,r.href),await s(500),await H.init(o,f);xe.set(!1)};return Ie(async()=>{c()}),[i]}class Pn extends ee{constructor(e){super(),te(this,e,An,Cn,j,{})}}function Un(n){let e,t;return e=new Pn({}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function Tn(n){let e,t;return e=new Qn({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,a){U(e,l,a),t=!0},p(l,[a]){const s={};a&1&&(s.$$scope={dirty:a,ctx:l}),e.$set(s)},i(l){t||(x(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}kt=class extends ee{constructor(n){super(),te(this,n,null,Tn,j,{})}}});export{Hn as __tla,kt as component};
